/*! For license information please see index.js.LICENSE.txt */
(()=>{"use strict";var t={d:(r,o)=>{for(var a in o)t.o(o,a)&&!t.o(r,a)&&Object.defineProperty(r,a,{enumerable:!0,get:o[a]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r)};function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function _unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return _arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return _arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,c=!0,u=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return c=t.done,t},e:function e(t){u=!0,l=t},f:function f(){try{c||null==o.return||o.return()}finally{if(u)throw l}}}}function _arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function ownKeys(t,r){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),o.push.apply(o,a)}return o}function _objectSpread(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(o),!0).forEach((function(r){_defineProperty(t,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(o,r))}))}return t}function _regeneratorRuntime(){_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},l=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var l=r&&r.prototype instanceof Generator?r:Generator,c=Object.create(l.prototype),u=new Context(i||[]);return a(c,"_invoke",{value:makeInvokeMethod(t,o,u)}),c}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,l,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h(values([])));v&&v!==r&&o.call(v,l)&&(d=v);var y=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,l,c){var u=tryCatch(t[a],t,i);if("throw"!==u.type){var p=u.arg,d=p.value;return d&&"object"==_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,l,c)}),(function(t){invoke("throw",t,l,c)})):r.resolve(d).then((function(t){p.value=t,l(p)}),(function(t){return invoke("throw",t,l,c)}))}c(u.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,l){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw l;return doneResult()}for(o.method=i,o.arg=l;;){var c=o.delegate;if(c){var u=maybeInvokeDelegate(c,o);if(u){if(u===p)continue;return u}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=r.method,a=t.iterator[o];if(void 0===a)return r.delegate=null,"throw"===o&&t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==o&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+o+"' method")),p;var i=tryCatch(a,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,p;var l=i.arg;return l?l.done?(r[t.resultName]=l.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):l:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[l];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(y,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,l){void 0===l&&(l=Promise);var c=new AsyncIterator(wrap(r,o,a,i),l);return t.isGeneratorFunction(o)?c:c.next().then((function(t){return t.done?t.value:c.next()}))},defineIteratorMethods(y),define(y,u,"Generator"),define(y,l,(function(){return this})),define(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return l.type="throw",l.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],l=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var l=i;break}}l&&("break"===t||"continue"===t)&&l.tryLoc<=r&&r<=l.finallyLoc&&(l=null);var c=l?l.completion:{};return c.type=t,c.arg=r,l?(this.method="next",this.next=l.finallyLoc,p):this.complete(c)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function asyncGeneratorStep(t,r,o,a,i,l,c){try{var u=t[l](c),p=u.value}catch(t){return void o(t)}u.done?r(p):Promise.resolve(p).then(a,i)}function _asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var l=t.apply(r,o);function _next(t){asyncGeneratorStep(l,a,i,_next,_throw,"next",t)}function _throw(t){asyncGeneratorStep(l,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,_toPropertyKey(a.key),a)}}function _createClass(t,r,o){return r&&_defineProperties(t.prototype,r),o&&_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,r,o){return(r=_toPropertyKey(r))in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}function _toPropertyKey(t){var r=function _toPrimitive(t,r){if("object"!==_typeof(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var a=o.call(t,r||"default");if("object"!==_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"===_typeof(r)?r:String(r)}t.d({},{c:()=>Z});var r=function(){function Socket(){_classCallCheck(this,Socket)}var t;return _createClass(Socket,null,[{key:"__$onMessage",value:(t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(t){var r,o,a,i,l,c,u;return _regeneratorRuntime().wrap((function _callee$(p){for(;;)switch(p.prev=p.next){case 0:if(!(r=t.__$socketOptions).__$storeName){p.next=12;break}if(!r.__$request){p.next=10;break}if((o=this.__$stores[r.__$storeName])._isLive){p.next=7;break}return p.abrupt("return");case 7:game.socket.emit("module.".concat(Z),{__$socketOptions:{__$storeName:r.__$storeName,user:game.user.id},data:o.getData()}),p.next=11;break;case 10:this.__$stores[r.__$storeName].synchronize(t.data,game.users.get(r.user));case 11:return p.abrupt("return");case 12:if("__$response"!==r.__$eventName){p.next=16;break}return a=r.__$responseKey,this.__$promises[a]&&(this.__$promises[a].resolve({user:game.users.get(r.__$userId),response:t.result}),delete this.__$promises[a]),p.abrupt("return");case 16:if(r.users.includes(game.user.id)){p.next=18;break}return p.abrupt("return");case 18:return i=this.__$callbacks[r.__$eventName],delete t.__$socketOptions,p.next=22,i(t);case 22:l=p.sent,r.response&&(c="".concat(r.__$eventId,".").concat(game.user.id),u={__$socketOptions:{__$eventName:"__$response",__$responseKey:c,__$userId:game.user.id},result:l},this.__$socket.emit("module.".concat(Z),u));case 24:case"end":return p.stop()}}),_callee,this)}))),function __$onMessage(r){return t.apply(this,arguments)})},{key:"__$parseUsers",value:function __$parseUsers(t){var r;if(Array.isArray(null===(r=t)||void 0===r?void 0:r.users))return t;"string"==typeof t&&(t={users:t}),Array.isArray(t)&&(t={users:t}),t.users=t.users||this.USERS.ALL;var o=game.users.filter((function(t){return t.active})),a=t.users;return a===this.USERS.ALL?t.users=o.map((function(t){return t.id})):a===this.USERS.GMS?t.users=o.filter((function(t){return t.isGM})).map((function(t){return t.id})):a===this.USERS.PLAYERS?t.users=o.filter((function(t){return!t.isGM})).map((function(t){return t.id})):a===this.USERS.OTHERS?t.users=o.filter((function(t){return t.id!==game.user.id})).map((function(t){return t.id})):a===this.USERS.FIRSTGM?(game.users.activeGM||(t.users=[],ui.notifications.error(game.modules.get(Z).title+": This operation requires a Game Master to be connected.")),t.users=[game.users.activeGM.id]):a===this.USERS.SELF&&(t.users=[game.user.id]),t}},{key:"register",value:function register(t,r){var o=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.__$socket||(this.__$socket=game.socket,game.socket.on("module.".concat(Z),this.__$onMessage.bind(this))),this.__$reserved.includes(t))throw new Error("Socket event name ".concat(t," is reserved"));this.__$callbacks[t]=r;var i=function(){var i=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(){var i,l,c,u,p,d,h,v,y,m,_,g,b,w,P=arguments;return _regeneratorRuntime().wrap((function _callee3$(x){for(;;)switch(x.prev=x.next){case 0:if(i=P.length>0&&void 0!==P[0]?P[0]:{},l=P.length>1&&void 0!==P[1]?P[1]:{},l=_objectSpread(_objectSpread({},a),l),l=o.__$parseUsers(l),c=foundry.utils.randomID(),l.__$eventId=c,l.__$eventName=t,u=[],p=l.users.includes(game.user.id),l.users=l.users.filter((function(t){return t!==game.user.id})),!l.response){x.next=28;break}d=_createForOfIteratorHelper(l.users),x.prev=12,v=_regeneratorRuntime().mark((function _loop(){var t;return _regeneratorRuntime().wrap((function _loop$(r){for(;;)switch(r.prev=r.next){case 0:t=h.value,u.push(new Promise((function(r,a){var i="".concat(c,".").concat(t);o.__$promises[i]={resolve:r,reject:a}})));case 2:case"end":return r.stop()}}),_loop)})),d.s();case 15:if((h=d.n()).done){x.next=19;break}return x.delegateYield(v(),"t0",17);case 17:x.next=15;break;case 19:x.next=24;break;case 21:x.prev=21,x.t1=x.catch(12),d.e(x.t1);case 24:return x.prev=24,d.f(),x.finish(24);case 27:setTimeout((function(){var t,r=_createForOfIteratorHelper(l.users);try{for(r.s();!(t=r.n()).done;){var a=t.value,i="".concat(c,".").concat(a);o.__$promises[i]&&(o.__$promises[i].reject({user:game.users.get(a),response:"timeout"}),delete o.__$promises[i])}}catch(t){r.e(t)}finally{r.f()}}),l.timeout||3e4);case 28:return i.__$socketOptions=l,o.__$socket.emit("module.".concat(Z),i),y=[],p&&(m=function(){var t=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(){return _regeneratorRuntime().wrap((function _callee2$(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=game.user,t.next=3,r(i);case 3:return t.t1=t.sent,t.abrupt("return",{user:t.t0,response:t.t1});case 5:case"end":return t.stop()}}),_callee2)})));return function localWrapper(){return t.apply(this,arguments)}}(),u.push(m())),x.next=34,Promise.all(u);case 34:_=x.sent,g=_createForOfIteratorHelper(_);try{for(g.s();!(b=g.n()).done;)w=b.value,y.push(w)}catch(t){g.e(t)}finally{g.f()}return x.abrupt("return",y);case 38:case"end":return x.stop()}}),_callee3,null,[[12,21,24,27]])})));return function wrappedCallback(){return i.apply(this,arguments)}}();this[t]=i.bind(this)}},{key:"registerStore",value:function registerStore(t){var r=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this.__$reserved.includes(t))throw new Error("Store name ".concat(t," is reserved"));if("object"!==_typeof(a))throw new Error("Initial value for store must be an object");return this.__$stores[t]=new o(t,a,i),Object.defineProperty(this,t,{get:function get(){return r.__$stores[t].getData()},set:function set(o){r.__$stores[t].setData(o)}}),this.__$stores[t]}}]),Socket}();_defineProperty(r,"__$callbacks",{}),_defineProperty(r,"__$stores",{}),_defineProperty(r,"__$promises",{}),_defineProperty(r,"USERS",{GMS:"gms",PLAYERS:"players",ALL:"all",OTHERS:"others",FIRSTGM:"firstGM",SELF:"self"}),_defineProperty(r,"__$reserved",["__$eventName","__$response","__$onMessage","__$parseUsers","register","USERS"]);var o=function(){function SynchronizedStore(t,r,o){_classCallCheck(this,SynchronizedStore),this._storeName=t,this._onChange=o,this._data=r,this._timestamp=Date.now(),this._isLive=!1,game.socket.emit("module.".concat(Z),{__$socketOptions:{__$storeName:this._storeName,__$request:!0,user:game.user.id}})}return _createClass(SynchronizedStore,[{key:"synchronize",value:function synchronize(t){var r;this._data=t,this._timestamp=Date.now(),this._isLive=!0,null===(r=this._onChange)||void 0===r||r.call(this,this.data)}},{key:"getData",value:function getData(){return this._data}},{key:"setData",value:function setData(t){this.synchronize(t),game.socket.emit("module.".concat(Z),{__$socketOptions:{__$storeName:this._storeName,user:game.user.id},data:t})}}]),SynchronizedStore}();function config_typeof(t){return config_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},config_typeof(t)}function config_regeneratorRuntime(){config_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},l=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var l=r&&r.prototype instanceof Generator?r:Generator,c=Object.create(l.prototype),u=new Context(i||[]);return a(c,"_invoke",{value:makeInvokeMethod(t,o,u)}),c}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,l,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h(values([])));v&&v!==r&&o.call(v,l)&&(d=v);var y=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,l,c){var u=tryCatch(t[a],t,i);if("throw"!==u.type){var p=u.arg,d=p.value;return d&&"object"==config_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,l,c)}),(function(t){invoke("throw",t,l,c)})):r.resolve(d).then((function(t){p.value=t,l(p)}),(function(t){return invoke("throw",t,l,c)}))}c(u.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,l){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw l;return doneResult()}for(o.method=i,o.arg=l;;){var c=o.delegate;if(c){var u=maybeInvokeDelegate(c,o);if(u){if(u===p)continue;return u}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=r.method,a=t.iterator[o];if(void 0===a)return r.delegate=null,"throw"===o&&t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==o&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+o+"' method")),p;var i=tryCatch(a,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,p;var l=i.arg;return l?l.done?(r[t.resultName]=l.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):l:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[l];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(y,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,l){void 0===l&&(l=Promise);var c=new AsyncIterator(wrap(r,o,a,i),l);return t.isGeneratorFunction(o)?c:c.next().then((function(t){return t.done?t.value:c.next()}))},defineIteratorMethods(y),define(y,u,"Generator"),define(y,l,(function(){return this})),define(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return l.type="throw",l.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],l=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var l=i;break}}l&&("break"===t||"continue"===t)&&l.tryLoc<=r&&r<=l.finallyLoc&&(l=null);var c=l?l.completion:{};return c.type=t,c.arg=r,l?(this.method="next",this.next=l.finallyLoc,p):this.complete(c)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function config_asyncGeneratorStep(t,r,o,a,i,l,c){try{var u=t[l](c),p=u.value}catch(t){return void o(t)}u.done?r(p):Promise.resolve(p).then(a,i)}function config_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var l=t.apply(r,o);function _next(t){config_asyncGeneratorStep(l,a,i,_next,_throw,"next",t)}function _throw(t){config_asyncGeneratorStep(l,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function _slicedToArray(t,r){return function _arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function _iterableToArrayLimit(t,r){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var a,i,l,c,u=[],p=!0,d=!1;try{if(l=(o=o.call(t)).next,0===r){if(Object(o)!==o)return;p=!1}else for(;!(p=(a=l.call(o)).done)&&(u.push(a.value),u.length!==r);p=!0);}catch(t){d=!0,i=t}finally{try{if(!p&&null!=o.return&&(c=o.return(),Object(c)!==c))return}finally{if(d)throw i}}return u}}(t,r)||function settings_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return settings_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return settings_arrayLikeToArray(t,r)}(t,r)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function settings_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function registerSettings(){!function registerSettingsArray(t){for(var r=0,o=Object.entries(t);r<o.length;r++){var a=_slicedToArray(o[r],2),i=a[0],l=a[1];l.name||(l.name="".concat(Z,".settings.").concat(i,".name")),l.hint||(l.hint="".concat(Z,".settings.").concat(i,".hint")),game.settings.register(Z,i,l)}}({autoDelete:{scope:"world",config:!0,type:Boolean,default:!1}})}function propagator_typeof(t){return propagator_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},propagator_typeof(t)}function propagator_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function propagator_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return propagator_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return propagator_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,c=!0,u=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return c=t.done,t},e:function e(t){u=!0,l=t},f:function f(){try{c||null==o.return||o.return()}finally{if(u)throw l}}}}function propagator_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function propagator_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,(i=a.key,l=void 0,l=function propagator_toPrimitive(t,r){if("object"!==propagator_typeof(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var a=o.call(t,r||"default");if("object"!==propagator_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(i,"string"),"symbol"===propagator_typeof(l)?l:String(l)),a)}var i,l}var a=function(){function Propagator(){!function propagator_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Propagator)}return function propagator_createClass(t,r,o){return r&&propagator_defineProperties(t.prototype,r),o&&propagator_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(Propagator,null,[{key:"getSnappedPositionFromTokenData",value:function getSnappedPositionFromTokenData(t,r){return canvas.tokens.createObject(r).getSnappedPosition(t)}},{key:"getFreePosition",value:function getFreePosition(t,r){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=new CONFIG.Token.documentClass(null!=t?t:{},{parent:canvas.scene});r=canvas.grid.getCenterPoint(r);var i,l=Propagator.generatePositions(r,a),c=propagator_createForOfIteratorHelper(l);try{for(c.s();!(i=c.n()).done;){var u=i.value;if(Propagator.canFit(a,u,l[0],o))return u}}catch(t){c.e(t)}finally{c.f()}}},{key:"generatePositions",value:function generatePositions(t,r){for(var o=[Propagator.getSnappedPositionFromTokenData({x:t.x-1,y:t.y-1},r)],a=canvas.scene.dimensions.size;a<10*canvas.scene.dimensions.size;a+=canvas.scene.dimensions.size)for(var i=0;i<2*Math.PI;i+=Math.PI/(4*a/canvas.scene.dimensions.size)){var l=Propagator.getSnappedPositionFromTokenData({x:t.x+a*Math.cos(i),y:t.y+a*Math.sin(i)},r);o.push(l)}return o}},{key:"isFree",value:function isFree(t){var r,o=propagator_createForOfIteratorHelper(canvas.tokens.placeables);try{for(o.s();!(r=o.n()).done;){var a=r.value;if(new PIXI.Rectangle(a.document.x,a.document.y,a.document.width*canvas.scene.dimensions.size,a.document.height*canvas.scene.dimensions.size).contains(t.x,t.y))return!1}}catch(t){o.e(t)}finally{o.f()}return!0}},{key:"canFit",value:function canFit(t,r,o,a){for(var i,l,c=0;c<t.width;c++)for(var u=0;u<t.height;u++){var p=r.x+u*canvas.scene.dimensions.size,d=r.y+c*canvas.scene.dimensions.size;if(!Propagator.isFree({x:p,y:d}))return!1}var h=null!==(i=null===(l=CONFIG.Canvas.polygonBackends.move.testCollision(o,{x:r.x+t.width/2,y:r.y+t.height/2},{type:"move"}))||void 0===l?void 0:l.length)&&void 0!==i?i:0;return!a||!h}}]),Propagator}();function templatePreview_typeof(t){return templatePreview_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},templatePreview_typeof(t)}function templatePreview_regeneratorRuntime(){templatePreview_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},l=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var l=r&&r.prototype instanceof Generator?r:Generator,c=Object.create(l.prototype),u=new Context(i||[]);return a(c,"_invoke",{value:makeInvokeMethod(t,o,u)}),c}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,l,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h(values([])));v&&v!==r&&o.call(v,l)&&(d=v);var y=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,l,c){var u=tryCatch(t[a],t,i);if("throw"!==u.type){var p=u.arg,d=p.value;return d&&"object"==templatePreview_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,l,c)}),(function(t){invoke("throw",t,l,c)})):r.resolve(d).then((function(t){p.value=t,l(p)}),(function(t){return invoke("throw",t,l,c)}))}c(u.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,l){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw l;return doneResult()}for(o.method=i,o.arg=l;;){var c=o.delegate;if(c){var u=maybeInvokeDelegate(c,o);if(u){if(u===p)continue;return u}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=r.method,a=t.iterator[o];if(void 0===a)return r.delegate=null,"throw"===o&&t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==o&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+o+"' method")),p;var i=tryCatch(a,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,p;var l=i.arg;return l?l.done?(r[t.resultName]=l.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):l:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[l];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(y,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,l){void 0===l&&(l=Promise);var c=new AsyncIterator(wrap(r,o,a,i),l);return t.isGeneratorFunction(o)?c:c.next().then((function(t){return t.done?t.value:c.next()}))},defineIteratorMethods(y),define(y,u,"Generator"),define(y,l,(function(){return this})),define(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return l.type="throw",l.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],l=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var l=i;break}}l&&("break"===t||"continue"===t)&&l.tryLoc<=r&&r<=l.finallyLoc&&(l=null);var c=l?l.completion:{};return c.type=t,c.arg=r,l?(this.method="next",this.next=l.finallyLoc,p):this.complete(c)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function templatePreview_asyncGeneratorStep(t,r,o,a,i,l,c){try{var u=t[l](c),p=u.value}catch(t){return void o(t)}u.done?r(p):Promise.resolve(p).then(a,i)}function templatePreview_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var l=t.apply(r,o);function _next(t){templatePreview_asyncGeneratorStep(l,a,i,_next,_throw,"next",t)}function _throw(t){templatePreview_asyncGeneratorStep(l,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function templatePreview_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,(i=a.key,l=void 0,l=function templatePreview_toPrimitive(t,r){if("object"!==templatePreview_typeof(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var a=o.call(t,r||"default");if("object"!==templatePreview_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(i,"string"),"symbol"===templatePreview_typeof(l)?l:String(l)),a)}var i,l}function _classPrivateMethodInitSpec(t,r){_checkPrivateRedeclaration(t,r),r.add(t)}function _checkPrivateRedeclaration(t,r){if(r.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function _classPrivateMethodGet(t,r,o){if(!r.has(t))throw new TypeError("attempted to get private field on non-instance");return o}function _classPrivateFieldSet(t,r,o){return function _classApplyDescriptorSet(t,r,o){if(r.set)r.set.call(t,o);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=o}}(t,_classExtractFieldDescriptor(t,r,"set"),o),o}function _classExtractFieldDescriptor(t,r,o){if(!r.has(t))throw new TypeError("attempted to "+o+" private field on non-instance");return r.get(t)}var i=new WeakMap,l=new WeakSet,c=new WeakSet,u=function(){function TemplatePreview(t,r){var o=this,a=r.origin,u=r.range,p=r.snappingMode;!function templatePreview_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,TemplatePreview),_classPrivateMethodInitSpec(this,c),_classPrivateMethodInitSpec(this,l),function _classPrivateFieldInitSpec(t,r,o){_checkPrivateRedeclaration(t,r),r.set(t,o)}(this,i,{writable:!0,value:CONST.GRID_SNAPPING_MODES.CORNER}),this.document=t,this.resolve=null,this.promise=new Promise((function(t){return o.resolve=t})),this.origin=a,this.range=u,this.isEvenDistance=this.document.distance/canvas.scene.dimensions.distance%2==0,void 0!==p&&_classPrivateFieldSet(this,i,p),this.range&&(this.range=u*canvas.scene.dimensions.distancePixels)}var t,r,o;return function templatePreview_createClass(t,r,o){return r&&templatePreview_defineProperties(t.prototype,r),o&&templatePreview_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(TemplatePreview,[{key:"activateListeners",value:function activateListeners(){this._onMoveFn=_classPrivateMethodGet(this,l,_onMove2).bind(this),this._onMouseUpFn=_classPrivateMethodGet(this,c,_onMouseUp2).bind(this),document.addEventListener("mousemove",this._onMoveFn),document.addEventListener("mouseup",this._onMouseUpFn)}},{key:"drawPreview",value:(o=templatePreview_asyncToGenerator(templatePreview_regeneratorRuntime().mark((function _callee(){var t,r,o,a,i,l,c,u,p;return templatePreview_regeneratorRuntime().wrap((function _callee$(d){for(;;)switch(d.prev=d.next){case 0:if((t=new PIXI.Container).alpha=0,r=new PIXI.Graphics,o=this.document.fillColor,a=this.document.borderColor,r.beginFill(o,.25),r.drawCircle(0,0,this.document.distance*canvas.dimensions.distancePixels/2),r.endFill(),!this.document.texture){d.next=13;break}return d.next=11,loadTexture(this.document.texture);case 11:(i=d.sent)&&(l=i.width,c=i.height,u=this.document.distance*canvas.dimensions.distancePixels,(p=new PIXI.Matrix).translate(-l/2,-c/2),p.scale(u/l,u/c),r.beginTextureFill({texture:i,matrix:p}),r.drawCircle(0,0,this.document.distance*canvas.dimensions.distancePixels/2),r.endFill());case 13:return r.lineStyle(1,a,1),r.drawCircle(0,0,this.document.distance*canvas.dimensions.distancePixels/2),t.addChild(r),this.previewObject=t,canvas.interface.grid.addChild(t),foundry.canvas.animation.CanvasAnimation.animate([{parent:t,attribute:"alpha",from:0,to:1}],{duration:200,easing:"easeInCircle"}),this.activateListeners(),this.drawRangePreview(),d.abrupt("return",this.promise);case 22:case"end":return d.stop()}}),_callee,this)}))),function drawPreview(){return o.apply(this,arguments)})},{key:"drawRangePreview",value:(r=templatePreview_asyncToGenerator(templatePreview_regeneratorRuntime().mark((function _callee2(){var t,r,o,a;return templatePreview_regeneratorRuntime().wrap((function _callee2$(i){for(;;)switch(i.prev=i.next){case 0:if(this.range&&this.origin){i.next=2;break}return i.abrupt("return");case 2:(t=new PIXI.Container).alpha=0,r=new PIXI.Graphics,o=this.document.fillColor,a=this.document.borderColor,r.beginFill(o,.15),r.drawCircle(0,0,this.range),r.endFill(),r.lineStyle(1,a,1),r.drawCircle(0,0,this.range),t.addChild(r),this.previewRangeObject=t,canvas.interface.grid.addChild(t),foundry.canvas.animation.CanvasAnimation.animate([{parent:t,attribute:"alpha",from:0,to:1}],{duration:200,easing:"easeInCircle"}),t.x=this.origin.x,t.y=this.origin.y;case 18:case"end":return i.stop()}}),_callee2,this)}))),function drawRangePreview(){return r.apply(this,arguments)})},{key:"cleanup",value:(t=templatePreview_asyncToGenerator(templatePreview_regeneratorRuntime().mark((function _callee3(){var t=this;return templatePreview_regeneratorRuntime().wrap((function _callee3$(r){for(;;)switch(r.prev=r.next){case 0:document.removeEventListener("mousemove",this._onMoveFn),document.removeEventListener("mouseup",this._onMouseUpFn),foundry.canvas.animation.CanvasAnimation.animate([{parent:this.previewObject,attribute:"alpha",to:0}],{duration:200,easing:"easeOutCircle"}).then((function(){t.previewObject.removeFromParent(),t.previewObject.destroy(!0)})),this.previewRangeObject&&foundry.canvas.animation.CanvasAnimation.animate([{parent:this.previewRangeObject,attribute:"alpha",to:0}],{duration:200,easing:"easeOutCircle"}).then((function(){t.previewRangeObject.removeFromParent(),t.previewRangeObject.destroy(!0)}));case 4:case"end":return r.stop()}}),_callee3,this)}))),function cleanup(){return t.apply(this,arguments)})}]),TemplatePreview}();function _onMove2(t){var r,o,a=canvas.canvasCoordinatesFromClient({x:t.clientX,y:t.clientY});a=this.isEvenDistance?canvas.grid.getSnappedPoint(a,{mode:(r=this,o=i,function _classApplyDescriptorGet(t,r){return r.get?r.get.call(t):r.value}(r,_classExtractFieldDescriptor(r,o,"get")))}):canvas.grid.getCenterPoint(a),this.document.updateSource(a),this.previewObject.x=a.x,this.previewObject.y=a.y}function _onMouseUp2(t){var r=2===t.button,o=0===t.button;(r||o)&&(this.cleanup(),this.resolve(o?this.document:null))}function formBuilder_typeof(t){return formBuilder_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},formBuilder_typeof(t)}function _toConsumableArray(t){return function _arrayWithoutHoles(t){if(Array.isArray(t))return formBuilder_arrayLikeToArray(t)}(t)||function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||formBuilder_unsupportedIterableToArray(t)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function formBuilder_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=formBuilder_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,c=!0,u=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return c=t.done,t},e:function e(t){u=!0,l=t},f:function f(){try{c||null==o.return||o.return()}finally{if(u)throw l}}}}function formBuilder_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return formBuilder_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?formBuilder_arrayLikeToArray(t,r):void 0}}function formBuilder_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function _get(t,r,o){var a=function _superPropBase(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=_getPrototypeOf(t)););return t}(t,r);if(a){var i=Object.getOwnPropertyDescriptor(a,r);return i.get?i.get.call(arguments.length<3?t:o):i.value}},_get.apply(this,arguments)}function _inherits(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&_setPrototypeOf(t,r)}function _setPrototypeOf(t,r){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(t,r){return t.__proto__=r,t},_setPrototypeOf(t,r)}function _createSuper(t){var r=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function _createSuperInternal(){var o,a=_getPrototypeOf(t);if(r){var i=_getPrototypeOf(this).constructor;o=Reflect.construct(a,arguments,i)}else o=a.apply(this,arguments);return function _possibleConstructorReturn(t,r){if(r&&("object"===formBuilder_typeof(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}(this,o)}}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function formBuilder_ownKeys(t,r){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),o.push.apply(o,a)}return o}function formBuilder_objectSpread(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?formBuilder_ownKeys(Object(o),!0).forEach((function(r){formBuilder_defineProperty(t,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):formBuilder_ownKeys(Object(o)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(o,r))}))}return t}function formBuilder_defineProperty(t,r,o){return(r=formBuilder_toPropertyKey(r))in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}function formBuilder_regeneratorRuntime(){formBuilder_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},l=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var l=r&&r.prototype instanceof Generator?r:Generator,c=Object.create(l.prototype),u=new Context(i||[]);return a(c,"_invoke",{value:makeInvokeMethod(t,o,u)}),c}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,l,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h(values([])));v&&v!==r&&o.call(v,l)&&(d=v);var y=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,l,c){var u=tryCatch(t[a],t,i);if("throw"!==u.type){var p=u.arg,d=p.value;return d&&"object"==formBuilder_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,l,c)}),(function(t){invoke("throw",t,l,c)})):r.resolve(d).then((function(t){p.value=t,l(p)}),(function(t){return invoke("throw",t,l,c)}))}c(u.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,l){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw l;return doneResult()}for(o.method=i,o.arg=l;;){var c=o.delegate;if(c){var u=maybeInvokeDelegate(c,o);if(u){if(u===p)continue;return u}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=r.method,a=t.iterator[o];if(void 0===a)return r.delegate=null,"throw"===o&&t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==o&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+o+"' method")),p;var i=tryCatch(a,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,p;var l=i.arg;return l?l.done?(r[t.resultName]=l.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):l:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[l];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(y,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,l){void 0===l&&(l=Promise);var c=new AsyncIterator(wrap(r,o,a,i),l);return t.isGeneratorFunction(o)?c:c.next().then((function(t){return t.done?t.value:c.next()}))},defineIteratorMethods(y),define(y,u,"Generator"),define(y,l,(function(){return this})),define(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return l.type="throw",l.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],l=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var l=i;break}}l&&("break"===t||"continue"===t)&&l.tryLoc<=r&&r<=l.finallyLoc&&(l=null);var c=l?l.completion:{};return c.type=t,c.arg=r,l?(this.method="next",this.next=l.finallyLoc,p):this.complete(c)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function formBuilder_asyncGeneratorStep(t,r,o,a,i,l,c){try{var u=t[l](c),p=u.value}catch(t){return void o(t)}u.done?r(p):Promise.resolve(p).then(a,i)}function formBuilder_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var l=t.apply(r,o);function _next(t){formBuilder_asyncGeneratorStep(l,a,i,_next,_throw,"next",t)}function _throw(t){formBuilder_asyncGeneratorStep(l,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function formBuilder_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function formBuilder_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,formBuilder_toPropertyKey(a.key),a)}}function formBuilder_createClass(t,r,o){return r&&formBuilder_defineProperties(t.prototype,r),o&&formBuilder_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function formBuilder_toPropertyKey(t){var r=function formBuilder_toPrimitive(t,r){if("object"!==formBuilder_typeof(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var a=o.call(t,r||"default");if("object"!==formBuilder_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"===formBuilder_typeof(r)?r:String(r)}function formBuilder_classPrivateMethodInitSpec(t,r){formBuilder_checkPrivateRedeclaration(t,r),r.add(t)}function formBuilder_classPrivateFieldInitSpec(t,r,o){formBuilder_checkPrivateRedeclaration(t,r),r.set(t,o)}function formBuilder_checkPrivateRedeclaration(t,r){if(r.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function formBuilder_classPrivateMethodGet(t,r,o){if(!r.has(t))throw new TypeError("attempted to get private field on non-instance");return o}function formBuilder_classPrivateFieldSet(t,r,o){return function formBuilder_classApplyDescriptorSet(t,r,o){if(r.set)r.set.call(t,o);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=o}}(t,formBuilder_classExtractFieldDescriptor(t,r,"set"),o),o}function formBuilder_classPrivateFieldGet(t,r){return function formBuilder_classApplyDescriptorGet(t,r){if(r.get)return r.get.call(t);return r.value}(t,formBuilder_classExtractFieldDescriptor(t,r,"get"))}function formBuilder_classExtractFieldDescriptor(t,r,o){if(!r.has(t))throw new TypeError("attempted to "+o+" private field on non-instance");return r.get(t)}var p="6uy8g1tXqHlhlp65dhiL-genericFormHelper-"+Z,d=new WeakMap,h=new WeakMap,v=new WeakMap,y=new WeakMap,m=new WeakMap,_=new WeakMap,g=new WeakMap,b=new WeakMap,w=new WeakSet,P=function(){function FormBuilder(){formBuilder_classCallCheck(this,FormBuilder),formBuilder_classPrivateMethodInitSpec(this,w),formBuilder_classPrivateFieldInitSpec(this,d,{writable:!0,value:[]}),formBuilder_classPrivateFieldInitSpec(this,h,{writable:!0,value:[]}),formBuilder_classPrivateFieldInitSpec(this,v,{writable:!0,value:[]}),formBuilder_classPrivateFieldInitSpec(this,y,{writable:!0,value:{position:{width:560,height:"auto"},window:{}}}),formBuilder_classPrivateFieldInitSpec(this,m,{writable:!0,value:null}),formBuilder_classPrivateFieldInitSpec(this,_,{writable:!0,value:null}),formBuilder_classPrivateFieldInitSpec(this,g,{writable:!0,value:null}),formBuilder_classPrivateFieldInitSpec(this,b,{writable:!0,value:null}),this.submitButton()}var t,r;return formBuilder_createClass(FormBuilder,[{key:"app",get:function get(){return formBuilder_classPrivateFieldGet(this,b)}},{key:"render",value:(r=formBuilder_asyncToGenerator(formBuilder_regeneratorRuntime().mark((function _callee(){var t;return formBuilder_regeneratorRuntime().wrap((function _callee$(r){for(;;)switch(r.prev=r.next){case 0:return(t=this.form()).render(!0),r.abrupt("return",t.promise);case 3:case"end":return r.stop()}}),_callee,this)}))),function render(){return r.apply(this,arguments)})},{key:"form",value:function form(){if(formBuilder_classPrivateFieldGet(this,b))return formBuilder_classPrivateFieldGet(this,b);var t=new T({tabs:formBuilder_classPrivateFieldGet(this,d),fields:formBuilder_classPrivateFieldGet(this,h),buttons:formBuilder_classPrivateFieldGet(this,v),options:formBuilder_classPrivateFieldGet(this,y)});return formBuilder_classPrivateFieldSet(this,b,t),t}},{key:"getHTML",value:function getHTML(){var t=this.form()._prepareContext();return T.registerPartial(),renderTemplate(p,t)}},{key:"getAsClass",value:function getAsClass(t){var r=formBuilder_objectSpread(formBuilder_objectSpread({},t),{},{tabs:formBuilder_classPrivateFieldGet(this,d),fields:formBuilder_classPrivateFieldGet(this,h),buttons:formBuilder_classPrivateFieldGet(this,v),options:formBuilder_classPrivateFieldGet(this,y)});return function(t){_inherits(_class,t);var o=_createSuper(_class);function _class(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return formBuilder_classCallCheck(this,_class),o.call(this,formBuilder_objectSpread(formBuilder_objectSpread({},r),t))}return formBuilder_createClass(_class)}(T)}},{key:"registerAsMenu",value:function registerAsMenu(){var t,r,o,a,i,l,c,u,p,d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},h=d.moduleId,v=d.key,y=d.name,m=d.label,_=d.icon,g=d.hint,b=d.scope,w=d.restricted,P=d.defaultValue,x=d.onChange,k=d.requiresReload;null!==(t=h)&&void 0!==t||(h=Z),null!==(r=b)&&void 0!==r||(b="world"),null!==(o=w)&&void 0!==o||(w=!0),null!==(a=P)&&void 0!==a||(P={}),null!==(i=v)&&void 0!==i||(v="settings"),null!==(l=_)&&void 0!==l||(_="fas fa-cogs"),null!==(c=m)&&void 0!==c||(m="Configure"),null!==(u=y)&&void 0!==u||(y="Configuration Menu"),null!==(p=g)&&void 0!==p||(g="Configure the module settings");var S={settingsMenu:{requiresReload:k,onChange:x,moduleId:h,key:v}},G=this.getAsClass(S);return game.settings.registerMenu(h,v+"-menu",{name:y,label:m,hint:g,icon:_,scope:b,restricted:w,type:G}),game.settings.register(h,v,{scope:b,config:!1,default:P,type:Object,onChange:x,requiresReload:k}),{getSetting:function getSetting(){return game.settings.get(h,v)},setSetting:function setSetting(t){return game.settings.set(h,v,t)}}}},{key:"insertHTML",value:(t=formBuilder_asyncToGenerator(formBuilder_regeneratorRuntime().mark((function _callee2(t,r){var o,a,i,l,c,u=arguments;return formBuilder_regeneratorRuntime().wrap((function _callee2$(p){for(;;)switch(p.prev=p.next){case 0:return o=u.length>2&&void 0!==u[2]?u[2]:"afterend",p.next=3,this.getHTML();case 3:if(a=p.sent,(i=document.createElement("div")).innerHTML=a,l=i.children[0],c=r?t.querySelector(r):t){p.next=10;break}throw new Error("Element ".concat(r," not found"));case 10:return c.insertAdjacentElement(o,l),p.abrupt("return",l);case 12:case"end":return p.stop()}}),_callee2,this)}))),function insertHTML(r,o){return t.apply(this,arguments)})},{key:"title",value:function title(t){return formBuilder_classPrivateFieldGet(this,y).window.title=t,this}},{key:"resizable",value:function resizable(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return formBuilder_classPrivateFieldGet(this,y).window.resizable=t,this}},{key:"info",value:function info(t){return formBuilder_classPrivateFieldGet(this,y).info=t,this}},{key:"object",value:function object(t){return formBuilder_classPrivateFieldSet(this,g,t),this}},{key:"size",value:function size(t){var r=t.width,o=t.height;return formBuilder_classPrivateFieldGet(this,y).position={width:null!=r?r:560,height:null!=o?o:"auto"},this}},{key:"submitButton",value:function submitButton(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.enabled,o=void 0===r||r,a=t.label,i=void 0===a?"Confirm":a,l=t.icon,submitButton={type:"submit",action:"submit",icon:void 0===l?"fa-solid fa-check":l,label:i};return o?formBuilder_classPrivateFieldGet(this,v).push(submitButton):formBuilder_classPrivateFieldSet(this,v,formBuilder_classPrivateFieldGet(this,v).filter((function(t){return"submit"!==t.action}))),this}},{key:"tab",value:function tab(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=r.id,a=r.group,i=r.icon,l=r.label,c=r.active,u=void 0!==c&&c;if(null!==(t=a)&&void 0!==t||(a="sheet"),!o&&formBuilder_classPrivateFieldGet(this,m))return formBuilder_classPrivateFieldSet(this,m,null),this;if(!o)throw new Error("You must provide an id for the tab");var tab={id:o,group:a,icon:i,label:l,active:u,fields:[]};return formBuilder_classPrivateFieldGet(this,d).push(tab),formBuilder_classPrivateFieldSet(this,m,tab),this}},{key:"fieldset",value:function fieldset(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).legend;if(!t&&formBuilder_classPrivateFieldGet(this,_))return formBuilder_classPrivateFieldSet(this,_,null),this;if(!t)throw new Error("You must provide a legend for the fieldset");var fieldset={legend:t,fieldset:!0,fields:[]};return formBuilder_classPrivateMethodGet(this,w,_addField2).call(this,fieldset),formBuilder_classPrivateFieldSet(this,_,fieldset),this}},{key:"html",value:function html(t){var r={html:t};return formBuilder_classPrivateMethodGet(this,w,_addField2).call(this,r),this}},{key:"text",value:function text(t){var r=t.name,o=t.label,a=t.hint,i=t.value,l={field:new foundry.data.fields.StringField,name:r,label:o,hint:a,value:i};return formBuilder_classPrivateMethodGet(this,w,_addField2).call(this,l),this}},{key:"number",value:function number(t){var r=t.name,o=t.label,a=t.hint,i=t.value,l=t.min,c=t.max,u=t.step,p={field:new foundry.data.fields.NumberField,name:r,label:o,hint:a,value:i,min:l,max:c,step:u};return formBuilder_classPrivateMethodGet(this,w,_addField2).call(this,p),this}},{key:"checkbox",value:function checkbox(t){var r=t.name,o=t.label,a=t.hint,i=t.value,l={field:new foundry.data.fields.BooleanField,name:r,label:o,hint:a,value:i};return formBuilder_classPrivateMethodGet(this,w,_addField2).call(this,l),this}},{key:"color",value:function color(t){var r=t.name,o=t.label,a=t.hint,i=t.value,l={field:new foundry.data.fields.ColorField,name:r,label:o,hint:a,value:i};return formBuilder_classPrivateMethodGet(this,w,_addField2).call(this,l),this}},{key:"file",value:function file(t){var r,o=t.name,a=t.type,i=t.label,l=t.hint,c=t.value;null!==(r=a)&&void 0!==r||(a="imagevideo");var u=x[a],p=new foundry.data.fields.FilePathField({categories:u});p.categories=[a];var d={field:p,name:o,label:i,hint:l,type:a,value:c};return formBuilder_classPrivateMethodGet(this,w,_addField2).call(this,d),this}},{key:"select",value:function select(t){var r=t.name,o=t.label,a=t.hint,i=t.value,l=t.options,c={field:inferSelectDataType(l)===Number?new foundry.data.fields.NumberField({choices:l}):new foundry.data.fields.StringField({choices:l}),name:r,label:o,hint:a,value:i,options:l};return formBuilder_classPrivateMethodGet(this,w,_addField2).call(this,c),this}},{key:"multiSelect",value:function multiSelect(t){var r=t.name,o=t.label,a=t.hint,i=t.value,l=t.options,c=inferSelectDataType(l)===Number?new foundry.data.fields.NumberField({choices:l}):new foundry.data.fields.StringField({choices:l}),u={field:new foundry.data.fields.SetField(c),name:r,label:o,hint:a,value:i,options:l};return formBuilder_classPrivateMethodGet(this,w,_addField2).call(this,u),this}},{key:"editor",value:function editor(t){var r=t.name,o=t.label,a=t.hint,i=t.value,l={field:new foundry.data.fields.HTMLField,name:r,label:o,hint:a,value:i};return formBuilder_classPrivateMethodGet(this,w,_addField2).call(this,l),this}},{key:"textArea",value:function textArea(t){var r=t.name,o=t.label,a=t.hint,i=t.value,l={field:new foundry.data.fields.JSONField,name:r,label:o,hint:a,value:i,stacked:!0};return formBuilder_classPrivateMethodGet(this,w,_addField2).call(this,l),this}},{key:"button",value:function button(t){var r,o=t.label,a=t.action,i=t.icon,l=t.callback;null!==(r=a)&&void 0!==r||(a=foundry.utils.randomID());var button={action:a,type:"button",icon:i,label:o,callback:l};return formBuilder_classPrivateFieldGet(this,v).push(button),this}}]),FormBuilder}();function _addField2(t){if(formBuilder_classPrivateFieldGet(this,g)&&t.name){var r=foundry.utils.getProperty(formBuilder_classPrivateFieldGet(this,g),t.name);void 0!==r&&(t.value=r)}return formBuilder_classPrivateFieldGet(this,_)?formBuilder_classPrivateFieldGet(this,_).fields.push(t):formBuilder_classPrivateFieldGet(this,m)?formBuilder_classPrivateFieldGet(this,m).fields.push(t):formBuilder_classPrivateFieldGet(this,h).push(t)}var x={imagevideo:["IMAGE","VIDEO"],image:["IMAGE"],video:["VIDEO"],audio:["AUDIO"],font:["FONT"],graphics:["GRAPHICS"]};function inferSelectDataType(t){var r=Object.keys(t);try{if(r.every((function(t){return"number"==typeof JSON.parse(t)})))return Number}catch(t){return String}return String}var k=new WeakMap,S=new WeakMap,G=new WeakMap,E=new WeakSet,T=function(t){_inherits(FormHelper,foundry.applications.api.HandlebarsApplicationMixin(foundry.applications.api.ApplicationV2));var r=_createSuper(FormHelper);function FormHelper(t){var o;formBuilder_classCallCheck(this,FormHelper);var a={};return t.buttons.forEach((function(t){return a[t.action]=t.callback})),formBuilder_classPrivateMethodInitSpec(_assertThisInitialized(o=r.call(this,formBuilder_objectSpread({actions:a},t.options))),E),formBuilder_classPrivateFieldInitSpec(_assertThisInitialized(o),k,{writable:!0,value:void 0}),formBuilder_classPrivateFieldInitSpec(_assertThisInitialized(o),S,{writable:!0,value:void 0}),formBuilder_classPrivateFieldInitSpec(_assertThisInitialized(o),G,{writable:!0,value:void 0}),FormHelper.registerPartial(),o.menu=t.settingsMenu,o.resolve,o.reject,o.promise=new Promise((function(t,r){o.resolve=t,o.reject=r})),formBuilder_classPrivateFieldSet(_assertThisInitialized(o),G,t.options.info),o.processFormStructure(t),o}return formBuilder_createClass(FormHelper,[{key:"processFormStructure",value:function processFormStructure(t){var r,o,a,i=this.menu?game.settings.get(this.menu.moduleId,this.menu.key):{},l=!!this.menu;if(null!==(r=t.tabs)&&void 0!==r&&r.length){this.__tabs={},t.tabs.find((function(t){return t.active}))||(t.tabs[0].active=!0);var c,u=formBuilder_createForOfIteratorHelper(t.tabs);try{for(u.s();!(c=u.n()).done;){var p,d,h=c.value;if(this.__tabs[h.id]={id:h.id,group:h.group,icon:h.icon,label:h.label,active:null!==(p=h.active)&&void 0!==p&&p,fields:null!==(d=h.fields)&&void 0!==d?d:[]},l){var v,y,m=formBuilder_createForOfIteratorHelper(null!==(v=h.fields)&&void 0!==v?v:[]);try{for(m.s();!(y=m.n()).done;){var _=y.value,g=foundry.utils.getProperty(i,_.name);void 0!==g&&(_.value=g)}}catch(t){m.e(t)}finally{m.f()}}}}catch(t){u.e(t)}finally{u.f()}}if(l){var b,w,P=formBuilder_createForOfIteratorHelper(null!==(b=t.fields)&&void 0!==b?b:[]);try{for(P.s();!(w=P.n()).done;){var x=w.value,G=foundry.utils.getProperty(i,x.name);void 0!==G&&(x.value=G)}}catch(t){P.e(t)}finally{P.f()}}formBuilder_classPrivateFieldSet(this,k,null!==(o=t.fields)&&void 0!==o?o:[]),formBuilder_classPrivateFieldSet(this,S,null!==(a=t.buttons)&&void 0!==a?a:[])}},{key:"_onClose",value:function _onClose(t){_get(_getPrototypeOf(FormHelper.prototype),"_onClose",this).call(this,t),this.promise.resolved||this.resolve(!1)}},{key:"_prepareContext",value:function _prepareContext(t){return{tabs:formBuilder_classPrivateMethodGet(this,E,_getTabs2).call(this),fields:formBuilder_classPrivateFieldGet(this,k),info:formBuilder_classPrivateFieldGet(this,G),buttons:[].concat(_toConsumableArray(formBuilder_classPrivateFieldGet(this,S).filter((function(t){return"submit"!==t.type}))),_toConsumableArray(formBuilder_classPrivateFieldGet(this,S).filter((function(t){return"submit"===t.type}))))}}},{key:"_onRender",value:function _onRender(t,r){_get(_getPrototypeOf(FormHelper.prototype),"_onRender",this).call(this,t,r),this.__tabs||this.element.querySelector("nav").classList.add("hidden")}},{key:"changeTab",value:function changeTab(){for(var t,r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];(t=_get(_getPrototypeOf(FormHelper.prototype),"changeTab",this)).call.apply(t,[this].concat(o))}},{key:"_onChangeForm",value:function _onChangeForm(t,r){_get(_getPrototypeOf(FormHelper.prototype),"_onChangeForm",this).call(this,t,r);new FormDataExtended(this.element)}},{key:"getFormData",value:function getFormData(){var t=new FormDataExtended(this.element);return foundry.utils.expandObject(t.object)}}],[{key:"registerPartial",value:function registerPartial(){if(!Handlebars.partials[p]){var t=Handlebars.compile(O);Handlebars.registerPartial(p,t)}}}]),FormHelper}();function _getTabs2(){for(var t,r=null!==(t=this.__tabs)&&void 0!==t?t:{},o=0,a=Object.values(r);o<a.length;o++){var i=a[o];if(i.cssClass=i.active?"active":"",i.active)break}return r}function _onSubmit3(){return(_onSubmit3=formBuilder_asyncToGenerator(formBuilder_regeneratorRuntime().mark((function _callee3(t,r,o){var a;return formBuilder_regeneratorRuntime().wrap((function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:if(a=foundry.utils.expandObject(o.object),this.resolve(a),!this.menu){t.next=6;break}return this.menu.requiresReload&&SettingsConfig.reloadConfirm(),this.menu.onChange&&this.menu.onChange(a),t.abrupt("return",game.settings.set(this.menu.moduleId,this.menu.key,a));case 6:case"end":return t.stop()}}),_callee3,this)})))).apply(this,arguments)}formBuilder_defineProperty(T,"DEFAULT_OPTIONS",{classes:["form-helper"],tag:"form",window:{contentClasses:["standard-form"]},position:{width:560,height:"auto"},form:{handler:function _classStaticPrivateMethodGet(t,r,o){return function _classCheckPrivateStaticAccess(t,r){if(t!==r)throw new TypeError("Private static access of wrong provenance")}(t,r),o}(T,T,(function _onSubmit(t,r,o){return _onSubmit3.apply(this,arguments)})),closeOnSubmit:!0},actions:{}}),formBuilder_defineProperty(T,"PARTS",{tabs:{template:"templates/generic/tab-navigation.hbs"},genericForm:{template:p,classes:["standard-form"]},footer:{template:"templates/generic/form-footer.hbs"}});var I="\n    {{#if field.fieldset}}\n    <fieldset>\n        <legend>{{localize field.legend}}</legend>\n        {{#each field.fields as |f|}}\n        {{#if f.html}}{{{f.html}}}{{else}}\n        {{formField f.field stacked=f.stacked type=f.type label=f.label hint=f.hint name=f.name value=f.value min=f.min max=f.max step=f.step localize=true}}\n        {{/if}}\n        {{/each}}\n    </fieldset>\n    {{else}}\n    {{#if field.html}}{{{field.html}}}{{else}}\n    {{formField field.field stacked=field.stacked type=field.type label=field.label hint=field.hint name=field.name value=field.value min=field.min max=field.max step=field.step localize=true}}\n    {{/if}}\n    {{/if}}\n        ",O='<div class="scrollable" style="max-height: 70vh;">\n    {{#if info}}{{{info}}}{{/if}}\n    {{#each tabs as |tab|}}\n\n    <section class="tab standard-form scrollable {{tab.cssClass}}" data-tab="{{tab.id}}" data-group="{{tab.group}}">\n        {{#each tab.fields as |field|}}\n        '.concat(I,"\n        {{/each}}\n    </section>\n\n    {{/each}}\n\n    {{#each fields as |field|}}\n    ").concat(I,"\n    {{/each}}\n</div>");function router_typeof(t){return router_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},router_typeof(t)}function router_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=function router_unsupportedIterableToArray(t,r){if(!t)return;if("string"==typeof t)return router_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return router_arrayLikeToArray(t,r)}(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,c=!0,u=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return c=t.done,t},e:function e(t){u=!0,l=t},f:function f(){try{c||null==o.return||o.return()}finally{if(u)throw l}}}}function router_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function router_regeneratorRuntime(){router_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},l=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var l=r&&r.prototype instanceof Generator?r:Generator,c=Object.create(l.prototype),u=new Context(i||[]);return a(c,"_invoke",{value:makeInvokeMethod(t,o,u)}),c}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,l,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h(values([])));v&&v!==r&&o.call(v,l)&&(d=v);var y=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,l,c){var u=tryCatch(t[a],t,i);if("throw"!==u.type){var p=u.arg,d=p.value;return d&&"object"==router_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,l,c)}),(function(t){invoke("throw",t,l,c)})):r.resolve(d).then((function(t){p.value=t,l(p)}),(function(t){return invoke("throw",t,l,c)}))}c(u.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,l){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw l;return doneResult()}for(o.method=i,o.arg=l;;){var c=o.delegate;if(c){var u=maybeInvokeDelegate(c,o);if(u){if(u===p)continue;return u}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=r.method,a=t.iterator[o];if(void 0===a)return r.delegate=null,"throw"===o&&t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==o&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+o+"' method")),p;var i=tryCatch(a,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,p;var l=i.arg;return l?l.done?(r[t.resultName]=l.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):l:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[l];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(y,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,l){void 0===l&&(l=Promise);var c=new AsyncIterator(wrap(r,o,a,i),l);return t.isGeneratorFunction(o)?c:c.next().then((function(t){return t.done?t.value:c.next()}))},defineIteratorMethods(y),define(y,u,"Generator"),define(y,l,(function(){return this})),define(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return l.type="throw",l.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],l=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var l=i;break}}l&&("break"===t||"continue"===t)&&l.tryLoc<=r&&r<=l.finallyLoc&&(l=null);var c=l?l.completion:{};return c.type=t,c.arg=r,l?(this.method="next",this.next=l.finallyLoc,p):this.complete(c)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function router_asyncGeneratorStep(t,r,o,a,i,l,c){try{var u=t[l](c),p=u.value}catch(t){return void o(t)}u.done?r(p):Promise.resolve(p).then(a,i)}function router_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var l=t.apply(r,o);function _next(t){router_asyncGeneratorStep(l,a,i,_next,_throw,"next",t)}function _throw(t){router_asyncGeneratorStep(l,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function router_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,(i=a.key,l=void 0,l=function router_toPrimitive(t,r){if("object"!==router_typeof(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var a=o.call(t,r||"default");if("object"!==router_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(i,"string"),"symbol"===router_typeof(l)?l:String(l)),a)}var i,l}function _classStaticPrivateFieldSpecGet(t,r,o){return router_classCheckPrivateStaticAccess(t,r),function _classCheckPrivateStaticFieldDescriptor(t,r){if(void 0===t)throw new TypeError("attempted to "+r+" private static field before its declaration")}(o,"get"),function router_classApplyDescriptorGet(t,r){if(r.get)return r.get.call(t);return r.value}(t,o)}function router_classStaticPrivateMethodGet(t,r,o){return router_classCheckPrivateStaticAccess(t,r),o}function router_classCheckPrivateStaticAccess(t,r){if(t!==r)throw new TypeError("Private static access of wrong provenance")}var A=function(){function Router(){!function router_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Router)}var t,r,o,a,i;return function router_createClass(t,r,o){return r&&router_defineProperties(t.prototype,r),o&&router_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(Router,null,[{key:"updateDocument",value:(i=router_asyncToGenerator(router_regeneratorRuntime().mark((function _callee(t,r){var o,a,i,l=arguments;return router_regeneratorRuntime().wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return o=l.length>2&&void 0!==l[2]?l[2]:{},t=router_classStaticPrivateMethodGet(this,Router,_getUUID).call(this,t),c.next=4,fromUuid(t);case 4:if(a=c.sent,!_classStaticPrivateFieldSpecGet(this,Router,R)||a.isOwner){c.next=12;break}return c.next=8,_classStaticPrivateFieldSpecGet(this,Router,L).updateDocument({uuid:t,data:r,options:o});case 8:return i=c.sent,c.abrupt("return",i[0].response);case 12:return c.next=14,a.update(r,o);case 14:return c.abrupt("return",c.sent);case 15:case"end":return c.stop()}}),_callee,this)}))),function updateDocument(t,r){return i.apply(this,arguments)})},{key:"deleteDocument",value:(a=router_asyncToGenerator(router_regeneratorRuntime().mark((function _callee2(t){var r,o,a,i=arguments;return router_regeneratorRuntime().wrap((function _callee2$(l){for(;;)switch(l.prev=l.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:{},t=router_classStaticPrivateMethodGet(this,Router,_getUUID).call(this,t),!_classStaticPrivateFieldSpecGet(this,Router,R)){l.next=9;break}return l.next=5,_classStaticPrivateFieldSpecGet(this,Router,L).deleteDocument({uuid:t,options:r});case 5:return o=l.sent,l.abrupt("return",o[0].response);case 9:return l.next=11,fromUuid(t);case 11:return a=l.sent,l.next=14,a.delete(r);case 14:return l.abrupt("return",l.sent);case 15:case"end":return l.stop()}}),_callee2,this)}))),function deleteDocument(t){return a.apply(this,arguments)})},{key:"updateDocuments",value:(o=router_asyncToGenerator(router_regeneratorRuntime().mark((function _callee3(t,r,o){var a,i,l,c,u,p,d,h=arguments;return router_regeneratorRuntime().wrap((function _callee3$(v){for(;;)switch(v.prev=v.next){case 0:return a=h.length>3&&void 0!==h[3]?h[3]:{},t=router_classStaticPrivateMethodGet(this,Router,_getUUID).call(this,t),v.next=4,fromUuid(t);case 4:if(i=v.sent,!_classStaticPrivateFieldSpecGet(this,Router,R)||i.isOwner){v.next=33;break}return v.next=8,_classStaticPrivateFieldSpecGet(this,Router,L).updateDocuments({uuid:t,documentType:r,data:o,options:a});case 8:l=v.sent,c=[],u=router_createForOfIteratorHelper(l[0].response),v.prev=11,u.s();case 13:if((p=u.n()).done){v.next=22;break}return d=p.value,v.t0=c,v.next=18,fromUuid(d);case 18:v.t1=v.sent,v.t0.push.call(v.t0,v.t1);case 20:v.next=13;break;case 22:v.next=27;break;case 24:v.prev=24,v.t2=v.catch(11),u.e(v.t2);case 27:return v.prev=27,u.f(),v.finish(27);case 30:return v.abrupt("return",c);case 33:return v.next=35,i.updateEmbeddedDocuments(r,o,a);case 35:return v.abrupt("return",v.sent);case 36:case"end":return v.stop()}}),_callee3,this,[[11,24,27,30]])}))),function updateDocuments(t,r,a){return o.apply(this,arguments)})},{key:"createActor",value:(r=router_asyncToGenerator(router_regeneratorRuntime().mark((function _callee4(t){var r,o;return router_regeneratorRuntime().wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:if(!_classStaticPrivateFieldSpecGet(this,Router,R)||game.user.hasPermission("ACTOR_CREATE")){a.next=10;break}return a.next=3,_classStaticPrivateFieldSpecGet(this,Router,L).createActor({data:t});case 3:return r=a.sent,o=r[0].response,a.next=7,fromUuid(o);case 7:case 12:return a.abrupt("return",a.sent);case 10:return a.next=12,Actor.implementation.create(t);case 13:case"end":return a.stop()}}),_callee4,this)}))),function createActor(t){return r.apply(this,arguments)})},{key:"createEmbeddedDocuments",value:(t=router_asyncToGenerator(router_regeneratorRuntime().mark((function _callee5(t,r,o){var a,i,l,c,u,p,d,h=arguments;return router_regeneratorRuntime().wrap((function _callee5$(v){for(;;)switch(v.prev=v.next){case 0:if(a=h.length>3&&void 0!==h[3]?h[3]:{},t=router_classStaticPrivateMethodGet(this,Router,_getUUID).call(this,t),!_classStaticPrivateFieldSpecGet(this,Router,R)||game.user.hasPermission("TOKEN_CREATE")){v.next=30;break}return v.next=5,_classStaticPrivateFieldSpecGet(this,Router,L).createEmbeddedDocuments({parent:t,documentType:r,data:o,options:a});case 5:i=v.sent,l=[],c=router_createForOfIteratorHelper(i[0].response),v.prev=8,c.s();case 10:if((u=c.n()).done){v.next=19;break}return p=u.value,v.t0=l,v.next=15,fromUuid(p);case 15:v.t1=v.sent,v.t0.push.call(v.t0,v.t1);case 17:v.next=10;break;case 19:v.next=24;break;case 21:v.prev=21,v.t2=v.catch(8),c.e(v.t2);case 24:return v.prev=24,c.f(),v.finish(24);case 27:return v.abrupt("return",l);case 30:return v.next=32,fromUuid(t);case 32:return d=v.sent,v.next=35,d.createEmbeddedDocuments(r,o,a);case 35:return v.abrupt("return",v.sent);case 36:case"end":return v.stop()}}),_callee5,this,[[8,21,24,27]])}))),function createEmbeddedDocuments(r,o,a){return t.apply(this,arguments)})}]),Router}();function _getUUID(t){var r,o,a;return null!==(r=null!==(o=t.uuid)&&void 0!==o?o:null===(a=t.document)||void 0===a?void 0:a.uuid)&&void 0!==r?r:t}var R={get:function _get_enableRouter(){return!0},set:void 0},L={writable:!0,value:r};function portal_typeof(t){return portal_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},portal_typeof(t)}function portal_slicedToArray(t,r){return function portal_arrayWithHoles(t){if(Array.isArray(t))return t}(t)||function portal_iterableToArrayLimit(t,r){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var a,i,l,c,u=[],p=!0,d=!1;try{if(l=(o=o.call(t)).next,0===r){if(Object(o)!==o)return;p=!1}else for(;!(p=(a=l.call(o)).done)&&(u.push(a.value),u.length!==r);p=!0);}catch(t){d=!0,i=t}finally{try{if(!p&&null!=o.return&&(c=o.return(),Object(c)!==c))return}finally{if(d)throw i}}return u}}(t,r)||portal_unsupportedIterableToArray(t,r)||function portal_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function portal_ownKeys(t,r){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),o.push.apply(o,a)}return o}function portal_objectSpread(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?portal_ownKeys(Object(o),!0).forEach((function(r){portal_defineProperty(t,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):portal_ownKeys(Object(o)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(o,r))}))}return t}function portal_createForOfIteratorHelper(t,r){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!o){if(Array.isArray(t)||(o=portal_unsupportedIterableToArray(t))||r&&t&&"number"==typeof t.length){o&&(t=o);var a=0,i=function F(){};return{s:i,n:function n(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,c=!0,u=!1;return{s:function s(){o=o.call(t)},n:function n(){var t=o.next();return c=t.done,t},e:function e(t){u=!0,l=t},f:function f(){try{c||null==o.return||o.return()}finally{if(u)throw l}}}}function portal_toConsumableArray(t){return function portal_arrayWithoutHoles(t){if(Array.isArray(t))return portal_arrayLikeToArray(t)}(t)||function portal_iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||portal_unsupportedIterableToArray(t)||function portal_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function portal_unsupportedIterableToArray(t,r){if(t){if("string"==typeof t)return portal_arrayLikeToArray(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?portal_arrayLikeToArray(t,r):void 0}}function portal_arrayLikeToArray(t,r){(null==r||r>t.length)&&(r=t.length);for(var o=0,a=new Array(r);o<r;o++)a[o]=t[o];return a}function portal_regeneratorRuntime(){portal_regeneratorRuntime=function _regeneratorRuntime(){return t};var t={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(t,r,o){t[r]=o.value},i="function"==typeof Symbol?Symbol:{},l=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,r,o){return Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[r]}try{define({},"")}catch(t){define=function define(t,r,o){return t[r]=o}}function wrap(t,r,o,i){var l=r&&r.prototype instanceof Generator?r:Generator,c=Object.create(l.prototype),u=new Context(i||[]);return a(c,"_invoke",{value:makeInvokeMethod(t,o,u)}),c}function tryCatch(t,r,o){try{return{type:"normal",arg:t.call(r,o)}}catch(t){return{type:"throw",arg:t}}}t.wrap=wrap;var p={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,l,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h(values([])));v&&v!==r&&o.call(v,l)&&(d=v);var y=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(t){["next","throw","return"].forEach((function(r){define(t,r,(function(t){return this._invoke(r,t)}))}))}function AsyncIterator(t,r){function invoke(a,i,l,c){var u=tryCatch(t[a],t,i);if("throw"!==u.type){var p=u.arg,d=p.value;return d&&"object"==portal_typeof(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(t){invoke("next",t,l,c)}),(function(t){invoke("throw",t,l,c)})):r.resolve(d).then((function(t){p.value=t,l(p)}),(function(t){return invoke("throw",t,l,c)}))}c(u.arg)}var i;a(this,"_invoke",{value:function value(t,o){function callInvokeWithMethodAndArg(){return new r((function(r,a){invoke(t,o,r,a)}))}return i=i?i.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,o){var a="suspendedStart";return function(i,l){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw l;return doneResult()}for(o.method=i,o.arg=l;;){var c=o.delegate;if(c){var u=maybeInvokeDelegate(c,o);if(u){if(u===p)continue;return u}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if("suspendedStart"===a)throw a="completed",o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a="executing";var d=tryCatch(t,r,o);if("normal"===d.type){if(a=o.done?"completed":"suspendedYield",d.arg===p)continue;return{value:d.arg,done:o.done}}"throw"===d.type&&(a="completed",o.method="throw",o.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var o=r.method,a=t.iterator[o];if(void 0===a)return r.delegate=null,"throw"===o&&t.iterator.return&&(r.method="return",r.arg=void 0,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==o&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+o+"' method")),p;var i=tryCatch(a,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,p;var l=i.arg;return l?l.done?(r[t.resultName]=l.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,p):l:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function pushTryEntry(t){var r={tryLoc:t[0]};1 in t&&(r.catchLoc=t[1]),2 in t&&(r.finallyLoc=t[2],r.afterLoc=t[3]),this.tryEntries.push(r)}function resetTryEntry(t){var r=t.completion||{};r.type="normal",delete r.arg,t.completion=r}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t){var r=t[l];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function next(){for(;++a<t.length;)if(o.call(t,a))return next.value=t[a],next.done=!1,next;return next.value=void 0,next.done=!0,next};return i.next=i}}return{next:doneResult}}function doneResult(){return{value:void 0,done:!0}}return GeneratorFunction.prototype=GeneratorFunctionPrototype,a(y,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),a(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===GeneratorFunction||"GeneratorFunction"===(r.displayName||r.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(r,o,a,i,l){void 0===l&&(l=Promise);var c=new AsyncIterator(wrap(r,o,a,i),l);return t.isGeneratorFunction(o)?c:c.next().then((function(t){return t.done?t.value:c.next()}))},defineIteratorMethods(y),define(y,u,"Generator"),define(y,l,(function(){return this})),define(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var r=Object(t),o=[];for(var a in r)o.push(a);return o.reverse(),function next(){for(;o.length;){var t=o.pop();if(t in r)return next.value=t,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function reset(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=void 0)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(t){if(this.done)throw t;var r=this;function handle(o,a){return l.type="throw",l.arg=t,r.next=o,a&&(r.method="next",r.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],l=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,r){for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var l=i;break}}l&&("break"===t||"continue"===t)&&l.tryLoc<=r&&r<=l.finallyLoc&&(l=null);var c=l?l.completion:{};return c.type=t,c.arg=r,l?(this.method="next",this.next=l.finallyLoc,p):this.complete(c)},complete:function complete(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),p},finish:function finish(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),resetTryEntry(o),p}},catch:function _catch(t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var i=a.arg;resetTryEntry(o)}return i}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(t,r,o){return this.delegate={iterator:values(t),resultName:r,nextLoc:o},"next"===this.method&&(this.arg=void 0),p}},t}function portal_asyncGeneratorStep(t,r,o,a,i,l,c){try{var u=t[l](c),p=u.value}catch(t){return void o(t)}u.done?r(p):Promise.resolve(p).then(a,i)}function portal_asyncToGenerator(t){return function(){var r=this,o=arguments;return new Promise((function(a,i){var l=t.apply(r,o);function _next(t){portal_asyncGeneratorStep(l,a,i,_next,_throw,"next",t)}function _throw(t){portal_asyncGeneratorStep(l,a,i,_next,_throw,"throw",t)}_next(void 0)}))}}function portal_defineProperties(t,r){for(var o=0;o<r.length;o++){var a=r[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,portal_toPropertyKey(a.key),a)}}function portal_classPrivateMethodInitSpec(t,r){portal_checkPrivateRedeclaration(t,r),r.add(t)}function portal_classPrivateFieldInitSpec(t,r,o){portal_checkPrivateRedeclaration(t,r),r.set(t,o)}function portal_checkPrivateRedeclaration(t,r){if(r.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function portal_defineProperty(t,r,o){return(r=portal_toPropertyKey(r))in t?Object.defineProperty(t,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[r]=o,t}function portal_toPropertyKey(t){var r=function portal_toPrimitive(t,r){if("object"!==portal_typeof(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var a=o.call(t,r||"default");if("object"!==portal_typeof(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"===portal_typeof(r)?r:String(r)}function portal_classPrivateMethodGet(t,r,o){if(!r.has(t))throw new TypeError("attempted to get private field on non-instance");return o}function portal_classPrivateFieldGet(t,r){return function portal_classApplyDescriptorGet(t,r){if(r.get)return r.get.call(t);return r.value}(t,portal_classExtractFieldDescriptor(t,r,"get"))}function portal_classPrivateFieldSet(t,r,o){return function portal_classApplyDescriptorSet(t,r,o){if(r.set)r.set.call(t,o);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=o}}(t,portal_classExtractFieldDescriptor(t,r,"set"),o),o}function portal_classExtractFieldDescriptor(t,r,o){if(!r.has(t))throw new TypeError("attempted to "+o+" private field on non-instance");return r.get(t)}var j={origin:null,distance:null,texture:""},C=new WeakMap,M=new WeakMap,D=new WeakMap,B=new WeakMap,N=new WeakMap,$=new WeakMap,W=new WeakMap,U=new WeakMap,z=new WeakMap,H=new WeakMap,Y=new WeakSet,K=new WeakSet,V=new WeakSet,q=new WeakSet,X=new WeakSet,J=new WeakSet,Q=function(){function Portal(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function portal_classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,Portal),portal_classPrivateMethodInitSpec(this,J),portal_classPrivateMethodInitSpec(this,X),portal_classPrivateMethodInitSpec(this,q),portal_classPrivateMethodInitSpec(this,V),portal_classPrivateMethodInitSpec(this,K),portal_classPrivateMethodInitSpec(this,Y),portal_classPrivateFieldInitSpec(this,C,{writable:!0,value:void 0}),portal_classPrivateFieldInitSpec(this,M,{writable:!0,value:[]}),portal_classPrivateFieldInitSpec(this,D,{writable:!0,value:[]}),portal_classPrivateFieldInitSpec(this,B,{writable:!0,value:[]}),portal_classPrivateFieldInitSpec(this,N,{writable:!0,value:null}),portal_classPrivateFieldInitSpec(this,$,{writable:!0,value:!1}),portal_classPrivateFieldInitSpec(this,W,{writable:!0,value:[]}),portal_classPrivateFieldInitSpec(this,U,{writable:!0,value:[]}),portal_classPrivateFieldInitSpec(this,z,{writable:!0,value:null}),portal_classPrivateFieldInitSpec(this,H,{writable:!0,value:0}),portal_classPrivateFieldSet(this,C,foundry.utils.mergeObject(foundry.utils.deepClone(j),t))}var t,r,o,i,l,c,u,p,d;return function portal_createClass(t,r,o){return r&&portal_defineProperties(t.prototype,r),o&&portal_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}(Portal,[{key:"template",get:function get(){return portal_classPrivateFieldGet(this,N)}},{key:"tokens",get:function get(){return portal_classPrivateFieldGet(this,M)}},{key:"origin",value:function origin(t){var r,o;if(t instanceof foundry.canvas.placeables.Token||t instanceof TokenDocument)portal_classPrivateFieldGet(this,C).teleportTarget=null!==(r=t.document)&&void 0!==r?r:t,portal_classPrivateFieldSet(this,z,null!==(o=t.document)&&void 0!==o?o:t);else if(t instanceof Actor)portal_classPrivateFieldSet(this,z,t);else if("string"==typeof target){var a,i;portal_classPrivateFieldSet(this,z,null!==(a=null!==(i=game.actors.getName(t))&&void 0!==i?i:fromUuidSync(t))&&void 0!==a?a:t)}return t&&Number.isFinite(t.x)&&Number.isFinite(t.y)?(t.center?portal_classPrivateFieldGet(this,C).origin={x:t.center.x,y:t.center.y,elevation:t.document.elevation}:portal_classPrivateFieldGet(this,C).origin={x:t.x,y:t.y,elevation:t.elevation},this):(ui.notifications.error("".concat(Z,".ERR.InvalidOrigin"),{localize:!0}),this)}},{key:"radius",get:function get(){return portal_classPrivateFieldGet(this,C).radius}},{key:"texture",value:function texture(t){return"string"==typeof t?portal_classPrivateFieldGet(this,C).texture=t:ui.notifications.error("".concat(Z,".ERR.InvalidTexture"),{localize:!0}),this}},{key:"actorAttributes",get:function get(){return portal_classPrivateFieldGet(this,W)}},{key:"tokenAttributes",get:function get(){return portal_classPrivateFieldGet(this,U)}},{key:"transformTarget",get:function get(){return portal_classPrivateFieldGet(this,z)}},{key:"addCreature",value:function addCreature(t){var r=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=o.updateData,i=void 0===a?null:a,l=o.count,c=void 0===l?1:l;if(Array.isArray(t))return t.forEach((function(t){return r.addCreature(t)})),this;t.count&&(c=t.count),t.creature&&(t=t.creature);var u=null;return t instanceof Token&&(u=t.document.toObject()),t instanceof TokenDocument&&(u=t.toObject()),(t instanceof Actor||"string"==typeof t)&&(u=portal_classPrivateMethodGet(this,K,_processAsyncCreature2).call(this,t)),u||ui.notifications.error("".concat(Z,".ERR.NoTokenData"),{localize:!0}),portal_classPrivateFieldGet(this,M).push(u),portal_classPrivateFieldGet(this,D).push(i),portal_classPrivateFieldGet(this,B).push(c),this}},{key:"size",value:function size(t){return Number.isFinite(t)?portal_classPrivateFieldGet(this,C).distance=t:ui.notifications.error("".concat(Z,".ERR.InvalidNumber"),{localize:!0}),this}},{key:"snappingMode",value:function snappingMode(t){return Object.values(CONST.GRID_SNAPPING_MODES).includes(t)?portal_classPrivateFieldGet(this,C).snappingMode=t:ui.notifications.error("".concat(Z,".ERR.InvalidSnappingMode"),{localize:!0}),this}},{key:"delay",value:function delay(t){return portal_classPrivateFieldSet(this,H,t),this}},{key:"color",value:function color(t){return portal_classPrivateFieldGet(this,C).color=t,this}},{key:"range",value:function range(t){return Number.isFinite(t)?portal_classPrivateFieldGet(this,C).range=t:ui.notifications.error("".concat(Z,".ERR.InvalidNumber"),{localize:!0}),this}},{key:"setLocation",value:function setLocation(t){var r;return(t=null!==(r=t.document)&&void 0!==r?r:t)instanceof MeasuredTemplateDocument||(t=new MeasuredTemplateDocument(t)),portal_classPrivateFieldSet(this,N,t),this}},{key:"pick",value:(d=portal_asyncToGenerator(portal_regeneratorRuntime().mark((function _callee(){var t,r,o,a,i,l,c,u=arguments;return portal_regeneratorRuntime().wrap((function _callee$(p){for(;;)switch(p.prev=p.next){case 0:return o=u.length>0&&void 0!==u[0]?u[0]:{},p.next=3,portal_classPrivateMethodGet(this,V,_preValidateAndProcessData2).call(this);case 3:return p.next=5,portal_classPrivateMethodGet(this,X,_getTemplateData2).call(this);case 5:if(!(a=p.sent)){p.next=15;break}if(!portal_classPrivateFieldGet(this,C).origin||!portal_classPrivateFieldGet(this,C).range){p.next=12;break}if(!(canvas.grid.measurePath([a,portal_classPrivateFieldGet(this,C).origin],{gridSpaces:!0}).distance>portal_classPrivateFieldGet(this,C).range)){p.next=12;break}return ui.notifications.error("".concat(Z,".ERR.OutOfRange"),{localize:!0}),p.abrupt("return",this.pick(o));case 12:portal_classPrivateFieldSet(this,N,a),p.next=16;break;case 15:return p.abrupt("return",!1);case 16:return i=portal_classPrivateFieldGet(this,N).x,l=portal_classPrivateFieldGet(this,N).y,c=null!==(t=null!==(r=this.origin.elevation)&&void 0!==r?r:portal_classPrivateFieldGet(this,N).elevation)&&void 0!==t?t:0,p.abrupt("return",{x:i,y:l,elevation:c});case 20:case"end":return p.stop()}}),_callee,this)}))),function pick(){return d.apply(this,arguments)})},{key:"spawn",value:(p=portal_asyncToGenerator(portal_regeneratorRuntime().mark((function _callee2(){var t,r,o,i,l,c,u,p,d,h,v,y,m,_=arguments;return portal_regeneratorRuntime().wrap((function _callee2$(g){for(;;)switch(g.prev=g.next){case 0:return t=_.length>0&&void 0!==_[0]?_[0]:{},(Array.isArray(t)||"string"==typeof t)&&this.addCreature(t),g.next=4,portal_classPrivateMethodGet(this,V,_preValidateAndProcessData2).call(this);case 4:if(portal_classPrivateFieldGet(this,N)){g.next=13;break}return g.next=7,this.pick(t);case 7:if(o=g.sent){g.next=10;break}return g.abrupt("return",!1);case 10:r=o,g.next=14;break;case 13:r={x:portal_classPrivateFieldGet(this,N).x,y:portal_classPrivateFieldGet(this,N).y,elevation:null!==(i=portal_classPrivateFieldGet(this,N).elevation)&&void 0!==i?i:0};case 14:if(!portal_classPrivateFieldGet(this,H)){g.next=17;break}return g.next=17,Portal.sleep(portal_classPrivateFieldGet(this,H));case 17:l=[],c=0;case 19:if(!(c<portal_classPrivateFieldGet(this,M).length)){g.next=44;break}return u=new Roll(portal_classPrivateFieldGet(this,B)[c].toString()),g.next=23,u.evaluate();case 23:return p=g.sent.total,d=portal_classPrivateFieldGet(this,M)[c],g.next=27,portal_classPrivateMethodGet(this,J,_processCompendiumImport2).call(this,d);case 27:h={x:r.x-d.width/2*canvas.scene.dimensions.size,y:r.y-d.height/2*canvas.scene.dimensions.size,elevation:r.elevation},v=0;case 29:if(!(v<p)){g.next=41;break}return y=a.getFreePosition(d,h,!0),d.updateSource({x:y.x,y:y.y,elevation:h.elevation}),g.next=34,A.createEmbeddedDocuments(canvas.scene,"Token",[d]);case 34:return m=g.sent[0],g.next=37,portal_classPrivateMethodGet(this,q,_processPostSpawnUpdate2).call(this,m,portal_classPrivateFieldGet(this,D)[c]);case 37:l.push(m);case 38:v++,g.next=29;break;case 41:c++,g.next=19;break;case 44:return g.abrupt("return",l);case 45:case"end":return g.stop()}}),_callee2,this)}))),function spawn(){return p.apply(this,arguments)})},{key:"dialog",value:(u=portal_asyncToGenerator(portal_regeneratorRuntime().mark((function _callee3(){var t,r,o,a,i,l,c,u=this,p=arguments;return portal_regeneratorRuntime().wrap((function _callee3$(d){for(;;)switch(d.prev=d.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:{spawn:!0,multipleChoice:!1,title:"".concat(Z,".DIALOG.Title"),transform:!1},d.next=3,portal_classPrivateMethodGet(this,V,_preValidateAndProcessData2).call(this);case 3:return r=portal_classPrivateFieldGet(this,M).map((function(t,r){return{token:t,count:portal_classPrivateFieldGet(u,B)[r],index:r}})),d.next=6,renderTemplate("modules/portal-lib/templates/dialog.hbs",{dialogData:r,transform:t.transform});case 6:return o=d.sent,a=[],d.next=10,foundry.applications.api.DialogV2.prompt({window:{title:t.title},position:{width:400},content:o,close:function close(){return!1},render:function render(r,o,i){var l=o.element;l.querySelectorAll("li").forEach((function(r,o){0===o&&(a=[r],r.classList.add("selected")),r.addEventListener("click",(function(o){t.multipleChoice||l.querySelectorAll("li").forEach((function(t){return t.classList.remove("selected")})),r.classList.toggle("selected"),a=portal_toConsumableArray(l.querySelectorAll("li.selected"))}))}))}});case 10:if("ok"===d.sent){d.next=13;break}return d.abrupt("return",!1);case 13:if(i=[],l=[],c=[],a.forEach((function(t){var r=parseInt(t.dataset.index),o=portal_classPrivateFieldGet(u,M)[r],a=t.querySelector("input").value,p=portal_classPrivateFieldGet(u,D)[r];i.push(o),l.push(a),c.push(p)})),portal_classPrivateFieldSet(this,M,i),portal_classPrivateFieldSet(this,B,l),portal_classPrivateFieldSet(this,D,c),!t.spawn){d.next=27;break}return d.next=24,this.spawn();case 24:return d.abrupt("return",d.sent);case 27:return d.abrupt("return",this);case 28:case"end":return d.stop()}}),_callee3,this)}))),function dialog(){return u.apply(this,arguments)})},{key:"teleport",value:(c=portal_asyncToGenerator(portal_regeneratorRuntime().mark((function _callee4(t,r){var o,a,i,l,c,u,p,d,h,v;return portal_regeneratorRuntime().wrap((function _callee4$(y){for(;;)switch(y.prev=y.next){case 0:if(t||portal_classPrivateFieldGet(this,C).teleportTarget||this.origin(canvas.tokens.controlled[0]),Number.isFinite(r)&&this.range(r),l=portal_classPrivateFieldGet(this,C).teleportTarget){y.next=6;break}return ui.notifications.error("".concat(Z,".ERR.NoTeleportTarget"),{localize:!0}),y.abrupt("return",!1);case 6:return y.next=8,portal_classPrivateMethodGet(this,V,_preValidateAndProcessData2).call(this);case 8:if(null===(o=portal_classPrivateFieldGet(this,N))||void 0===o){y.next=12;break}y.t0=o,y.next=15;break;case 12:return y.next=14,this.pick({});case 14:y.t0=y.sent;case 15:if(u=y.t0){y.next=18;break}return y.abrupt("return",!1);case 18:return p=null!==(a=null===(i=this.template)||void 0===i?void 0:i.undefinedElevation)&&void 0!==a&&a,c=u,d={x:.5*-l.width*canvas.grid.size,y:.5*-l.height*canvas.grid.size},c.x+=d.x,c.y+=d.y,h=l.object,c=h.getSnappedPosition(c,{mode:CONST.GRID_SNAPPING_MODES.TOP_LEFT_CORNER,resolution:2}),v=h.mesh.alpha,y.next=29,foundry.canvas.animation.CanvasAnimation.animate([{parent:h.mesh,attribute:"alpha",to:0}],{duration:300,easing:"easeOutCircle"});case 29:return y.next=31,A.updateDocument(l,{x:c.x,y:c.y,elevation:p?l.elevation:c.elevation},{animate:!1});case 31:return y.next=33,foundry.canvas.animation.CanvasAnimation.animate([{parent:h.mesh,attribute:"alpha",from:0,to:v}],{duration:300,easing:"easeInCircle"});case 33:return y.abrupt("return",this);case 34:case"end":return y.stop()}}),_callee4,this)}))),function teleport(t,r){return c.apply(this,arguments)})},{key:"addActorAttribute",value:function addActorAttribute(t){return portal_classPrivateFieldGet(this,W).push(t),this}},{key:"addTokenAttribute",value:function addTokenAttribute(t){return portal_classPrivateFieldGet(this,U).push(t),this}},{key:"transform",value:(l=portal_asyncToGenerator(portal_regeneratorRuntime().mark((function _callee5(){var t,r,o,a,i,l,c,u,p,d,h,v,y,m,_,g,b,w,P,x,k,S,G,E,T,I,O,R,L,j,C=arguments;return portal_regeneratorRuntime().wrap((function _callee5$(D){for(;;)switch(D.prev=D.next){case 0:return p=C.length>0&&void 0!==C[0]?C[0]:{},D.next=3,portal_classPrivateMethodGet(this,V,_preValidateAndProcessData2).call(this);case 3:if("string"!=typeof portal_classPrivateFieldGet(this,z)){D.next=9;break}return D.next=6,fromUuid(portal_classPrivateFieldGet(this,z));case 6:D.t0=D.sent,D.next=10;break;case 9:D.t0=portal_classPrivateFieldGet(this,z);case 10:if(d=D.t0){D.next=13;break}return D.abrupt("return",ui.notifications.error("".concat(Z,".ERR.InvalidTransformTarget"),{localize:!0}));case 13:if(h=d instanceof Actor?d:d.actor){D.next=16;break}return D.abrupt("return",ui.notifications.error("".concat(Z,".ERR.InvalidTransformTarget"),{localize:!0}));case 16:if(v=null!==(t=null!==(r=h.token)&&void 0!==r?r:h.getActiveTokens()[0])&&void 0!==t?t:h.prototypeToken,!(v=null!==(o=v.document)&&void 0!==o?o:v).getFlag(Z,"revertData")){D.next=21;break}return D.abrupt("return",Portal.revertTransformation(v,p));case 21:if(0!==portal_classPrivateFieldGet(this,M).length){D.next=23;break}return D.abrupt("return",ui.notifications.error("".concat(Z,".ERR.InvalidTransformCreature"),{localize:!0}));case 23:if(!(portal_classPrivateFieldGet(this,M).length>1)){D.next=26;break}return D.next=26,this.dialog({spawn:!1,multipleChoice:!1,title:"".concat(Z,".DIALOG.TransformTitle"),transform:!0});case 26:if((y=portal_classPrivateFieldGet(this,M)[0].actor)||null!==(a=portal_classPrivateFieldGet(this,M)[0].flags[Z])&&void 0!==a&&a.importActor){D.next=29;break}return D.abrupt("return",ui.notifications.error("".concat(Z,".ERR.InvalidTransformCreature"),{localize:!0}));case 29:m=null!==(i=null===(l=portal_classPrivateFieldGet(this,M)[0].flags[Z])||void 0===l?void 0:l.importActor)&&void 0!==i?i:y.toObject(),null!==(c=portal_classPrivateFieldGet(this,M)[0].flags[Z])&&void 0!==c&&c.importActor&&portal_classPrivateFieldGet(this,M)[0].updateSource({flags:portal_defineProperty({},Z,{importActor:null})}),foundry.utils.setProperty(m,"ownership.".concat(game.user.id),CONST.DOCUMENT_OWNERSHIP_LEVELS.OWNER),_=portal_createForOfIteratorHelper(portal_classPrivateFieldGet(this,W));try{for(_.s();!(g=_.n()).done;)b=g.value,(w=foundry.utils.getProperty(d,b))&&foundry.utils.setProperty(m,b,w)}catch(t){_.e(t)}finally{_.f()}P=portal_createForOfIteratorHelper(portal_classPrivateFieldGet(this,U));try{for(P.s();!(x=P.n()).done;)k=x.value,(S=foundry.utils.getProperty(v,k))&&foundry.utils.setProperty(m.prototypeToken,k,S)}catch(t){P.e(t)}finally{P.f()}if(m.name=m.name+" - [".concat(d.name,"]"),null==(G=game.actors.getName(m.name))){D.next=42;break}D.t1=G,D.next=45;break;case 42:return D.next=44,A.createActor(m);case 44:D.t1=D.sent;case 45:if(E=D.t1,T={top:h.sheet.position.top,left:h.sheet.position.left},I={tokenData:v.toObject(),createdActor:E.uuid,time:Date.now()},!(O=null!==(u=h.token)&&void 0!==u?u:h.getActiveTokens()[0])||portal_classPrivateFieldGet(this,U).includes("actorId")){D.next=56;break}return L=null!==(R=O.document)&&void 0!==R?R:O,D.next=53,E.getTokenDocument({x:L.x,y:L.y,actorId:E.id,flags:portal_defineProperty({},Z,{revertData:I})});case 53:return j=D.sent,D.next=56,A.updateDocument(L,j.toObject());case 56:return null!=p&&p.skipSheetRender||O.actor.sheet.render(!0,portal_objectSpread({},T)),D.abrupt("return",E);case 58:case"end":return D.stop()}}),_callee5,this)}))),function transform(){return l.apply(this,arguments)})}],[{key:"teleport",value:(i=portal_asyncToGenerator(portal_regeneratorRuntime().mark((function _callee6(t,r){return portal_regeneratorRuntime().wrap((function _callee6$(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(new Portal).teleport(t,r));case 1:case"end":return o.stop()}}),_callee6)}))),function teleport(t,r){return i.apply(this,arguments)})},{key:"spawn",value:(o=portal_asyncToGenerator(portal_regeneratorRuntime().mark((function _callee7(){var t,r,o=arguments;return portal_regeneratorRuntime().wrap((function _callee7$(a){for(;;)switch(a.prev=a.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},(r=new Portal).addCreature(t),a.next=5,r.spawn();case 5:return a.abrupt("return",a.sent);case 6:case"end":return a.stop()}}),_callee7)}))),function spawn(){return o.apply(this,arguments)})},{key:"transform",value:(r=portal_asyncToGenerator(portal_regeneratorRuntime().mark((function _callee8(){var t,r,o=arguments;return portal_regeneratorRuntime().wrap((function _callee8$(a){for(;;)switch(a.prev=a.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},r=new Portal,t.target||r.origin(canvas.tokens.controlled[0]),r.addCreature(t),a.next=6,r.transform();case 6:return a.abrupt("return",a.sent);case 7:case"end":return a.stop()}}),_callee8)}))),function transform(){return r.apply(this,arguments)})},{key:"revertTransformation",value:(t=portal_asyncToGenerator(portal_regeneratorRuntime().mark((function _callee9(t,r){var o,a,i,l,c,u,p;return portal_regeneratorRuntime().wrap((function _callee9$(d){for(;;)switch(d.prev=d.next){case 0:if(a=null!==(o=t.document)&&void 0!==o?o:t,i=a.getFlag(Z,"revertData")){d.next=4;break}return d.abrupt("return");case 4:return l={top:a.actor.sheet.position.top,left:a.actor.sheet.position.left},null!=r&&r.skipSheetRender||a.actor.sheet.close(),d.next=8,fromUuid(i.createdActor);case 8:if(c=d.sent,h="autoDelete",u=game.settings.get(Z,h),d.t0=u,d.t0){d.next=15;break}return d.next=14,foundry.applications.api.DialogV2.confirm({position:{width:400},window:{title:game.i18n.localize("".concat(Z,".DIALOG.DeleteTitle"))},content:game.i18n.localize("".concat(Z,".DIALOG.DeleteContent"))+"<hr>"+"<strong>".concat(c.name,"</strong>")});case 14:d.t0=d.sent;case 15:if(!d.t0){d.next=19;break}return d.next=19,A.deleteDocument(c);case 19:return p=i.tokenData,["x","y","elevation"].forEach((function(t){return delete p[t]})),foundry.utils.setProperty(p,"flags."+Z+".revertData",null),d.next=24,A.updateDocument(a,p);case 24:return null!=r&&r.skipSheetRender||a.actor.sheet.render(!0,portal_objectSpread({},l)),ui.notifications.info("".concat(Z,".INFO.RevertedTransformation"),{localize:!0}),d.abrupt("return",a);case 27:case"end":return d.stop()}var h}),_callee9)}))),function revertTransformation(r,o){return t.apply(this,arguments)})}]),Portal}();function _resolveTokenData2(){return _resolveTokenData3.apply(this,arguments)}function _resolveTokenData3(){return(_resolveTokenData3=portal_asyncToGenerator(portal_regeneratorRuntime().mark((function _callee10(){var t,r,o,a,i,l,c;return portal_regeneratorRuntime().wrap((function _callee10$(u){for(;;)switch(u.prev=u.next){case 0:t=[],r=portal_createForOfIteratorHelper(portal_classPrivateFieldGet(this,M)),u.prev=2,r.s();case 4:if((o=r.n()).done){u.next=13;break}return a=o.value,u.t0=t,u.next=9,a;case 9:u.t1=u.sent,u.t0.push.call(u.t0,u.t1);case 11:u.next=4;break;case 13:u.next=18;break;case 15:u.prev=15,u.t2=u.catch(2),r.e(u.t2);case 18:return u.prev=18,r.f(),u.finish(18);case 21:for(portal_classPrivateFieldSet(this,M,t.map((function(t){return new TokenDocument(t)}))),i=0;i<portal_classPrivateFieldGet(this,M).length;i++)c=portal_classPrivateFieldGet(this,M)[i],null!==(l=portal_classPrivateFieldGet(this,D)[i])&&void 0!==l&&l.token&&c.updateSource(portal_classPrivateFieldGet(this,D)[i].token);return u.abrupt("return",this);case 24:case"end":return u.stop()}}),_callee10,this,[[2,15,18,21]])})))).apply(this,arguments)}function _processAsyncCreature2(t){return _processAsyncCreature3.apply(this,arguments)}function _processAsyncCreature3(){return(_processAsyncCreature3=portal_asyncToGenerator(portal_regeneratorRuntime().mark((function _callee11(t){var r,o;return portal_regeneratorRuntime().wrap((function _callee11$(a){for(;;)switch(a.prev=a.next){case 0:if(r=t,"string"!=typeof t){a.next=5;break}return a.next=4,fromUuid(t);case 4:t=a.sent;case 5:if(t||(t=game.actors.getName(r)),t){a.next=8;break}return a.abrupt("return",null);case 8:if(!(t instanceof Actor)){a.next=14;break}return a.next=11,t.getTokenDocument();case 11:return(o=a.sent).actor||o.updateSource(portal_defineProperty({},"flags.".concat(Z,".importActor"),t.toObject())),a.abrupt("return",o);case 14:if(!(t instanceof TokenDocument)){a.next=16;break}return a.abrupt("return",t.toObject());case 16:if(!(t instanceof Token)){a.next=18;break}return a.abrupt("return",t.document.toObject());case 18:return a.abrupt("return",null);case 19:case"end":return a.stop()}}),_callee11)})))).apply(this,arguments)}function _preValidateAndProcessData2(){return _preValidateAndProcessData3.apply(this,arguments)}function _preValidateAndProcessData3(){return(_preValidateAndProcessData3=portal_asyncToGenerator(portal_regeneratorRuntime().mark((function _callee12(){var t,r,o;return portal_regeneratorRuntime().wrap((function _callee12$(a){for(;;)switch(a.prev=a.next){case 0:if(!portal_classPrivateFieldGet(this,$)){a.next=2;break}return a.abrupt("return",this);case 2:return portal_classPrivateFieldSet(this,$,!0),a.next=5,portal_classPrivateMethodGet(this,Y,_resolveTokenData2).call(this);case 5:return Number.isFinite(portal_classPrivateFieldGet(this,C).distance)||(r=null!==(t=portal_classPrivateFieldGet(this,M)[0])&&void 0!==t?t:portal_classPrivateFieldGet(this,C).teleportTarget,o=r?Math.max(r.width,r.height):1,portal_classPrivateFieldGet(this,C).distance=o*canvas.scene.dimensions.distance),"string"!=typeof portal_classPrivateFieldGet(this,C).color&&(portal_classPrivateFieldGet(this,C).color=game.user.color.toString()),a.abrupt("return",this);case 8:case"end":return a.stop()}}),_callee12,this)})))).apply(this,arguments)}function _processPostSpawnUpdate2(t,r){return _processPostSpawnUpdate3.apply(this,arguments)}function _processPostSpawnUpdate3(){return(_processPostSpawnUpdate3=portal_asyncToGenerator(portal_regeneratorRuntime().mark((function _callee13(t,r){var o,a,i,l;return portal_regeneratorRuntime().wrap((function _callee13$(c){for(;;)switch(c.prev=c.next){case 0:if(r){c.next=2;break}return c.abrupt("return");case 2:if(o=t.actor){c.next=5;break}return c.abrupt("return");case 5:if(!r.actor){c.next=8;break}return c.next=8,A.updateDocument(t.actor,r.actor);case 8:if(!r.embedded){c.next=16;break}a=portal_regeneratorRuntime().mark((function _loop(){var t,r,a,c,u;return portal_regeneratorRuntime().wrap((function _loop$(p){for(;;)switch(p.prev=p.next){case 0:return t=portal_slicedToArray(l[i],2),r=t[0],a=t[1],c=o.getEmbeddedCollection(r),u=[],c.forEach((function(t){var r,o=null!==(r=a[t.id])&&void 0!==r?r:a[t.name];o&&u.push(portal_objectSpread({_id:t.id},o))})),p.next=6,A.updateDocuments(o,r,u);case 6:case"end":return p.stop()}}),_loop)})),i=0,l=Object.entries(r.embedded);case 11:if(!(i<l.length)){c.next=16;break}return c.delegateYield(a(),"t0",13);case 13:i++,c.next=11;break;case 16:case"end":return c.stop()}}),_callee13)})))).apply(this,arguments)}function _getTemplateData2(){return _getTemplateData3.apply(this,arguments)}function _getTemplateData3(){return(_getTemplateData3=portal_asyncToGenerator(portal_regeneratorRuntime().mark((function _callee14(){var t,r,o,a,i,l,c;return portal_regeneratorRuntime().wrap((function _callee14$(p){for(;;)switch(p.prev=p.next){case 0:if((r=new MeasuredTemplateDocument).updateSource({distance:portal_classPrivateFieldGet(this,C).distance,fillColor:portal_classPrivateFieldGet(this,C).color,texture:portal_classPrivateFieldGet(this,C).texture}),null===(t=game.Levels3DPreview)||void 0===t||!t._active){p.next=15;break}return r.updateSource({distance:portal_classPrivateFieldGet(this,C).distance/2}),p.next=6,game.Levels3DPreview.CONFIG.entityClass.Template3D.drawPreview({document:r},!1);case 6:return o=p.sent,a=canvas.grid.getCenter(o.x,o.y),o.x=a[0],o.y=a[1],(i=new MeasuredTemplateDocument(o)).undefinedElevation=!1,p.abrupt("return",i);case 15:return l=new u(r,{origin:portal_classPrivateFieldGet(this,C).origin,range:portal_classPrivateFieldGet(this,C).range,snappingMode:portal_classPrivateFieldGet(this,C).snappingMode}),p.next=18,l.drawPreview();case 18:return(c=p.sent).undefinedElevation=!0,p.abrupt("return",c);case 21:case"end":return p.stop()}}),_callee14,this)})))).apply(this,arguments)}function _processCompendiumImport2(t){return _processCompendiumImport3.apply(this,arguments)}function _processCompendiumImport3(){return(_processCompendiumImport3=portal_asyncToGenerator(portal_regeneratorRuntime().mark((function _callee15(t){var r,o,a;return portal_regeneratorRuntime().wrap((function _callee15$(i){for(;;)switch(i.prev=i.next){case 0:if(null!==(r=t.flags[Z])&&void 0!==r&&r.importActor){i.next=2;break}return i.abrupt("return");case 2:if(null===(o=game.actors.getName(t.flags[Z].importActor.name))||void 0===o){i.next=6;break}i.t0=o,i.next=9;break;case 6:return i.next=8,A.createActor(t.flags[Z].importActor);case 8:i.t0=i.sent;case 9:a=i.t0,t.updateSource({actorId:a.id,flags:portal_defineProperty({},Z,{importActor:null})});case 11:case"end":return i.stop()}}),_callee15)})))).apply(this,arguments)}portal_defineProperty(Q,"FormBuilder",P),portal_defineProperty(Q,"sleep",(function(t){return new Promise((function(r){return setTimeout(r,t)}))}));var Z="portal-lib";globalThis.Portal=Q,Hooks.on("init",(function(){!function initConfig(){r.register("updateDocument",function(){var t=config_asyncToGenerator(config_regeneratorRuntime().mark((function _callee(t){var r,o,a,i,l;return config_regeneratorRuntime().wrap((function _callee$(c){for(;;)switch(c.prev=c.next){case 0:return r=t.uuid,o=t.data,a=t.options,c.next=3,fromUuid(r);case 3:if(i=c.sent){c.next=6;break}return c.abrupt("return",!1);case 6:return c.next=8,i.update(o,a);case 8:return l=c.sent,c.abrupt("return",l.uuid);case 10:case"end":return c.stop()}}),_callee)})));return function(r){return t.apply(this,arguments)}}(),{response:!0,timeout:5e3,users:r.USERS.FIRSTGM}),r.register("deleteDocument",function(){var t=config_asyncToGenerator(config_regeneratorRuntime().mark((function _callee2(t){var r,o,a,i;return config_regeneratorRuntime().wrap((function _callee2$(l){for(;;)switch(l.prev=l.next){case 0:return r=t.uuid,o=t.options,l.next=3,fromUuid(r);case 3:if(a=l.sent){l.next=6;break}return l.abrupt("return",!1);case 6:return l.next=8,a.delete(o);case 8:return i=l.sent,l.abrupt("return",i);case 10:case"end":return l.stop()}}),_callee2)})));return function(r){return t.apply(this,arguments)}}(),{response:!0,timeout:5e3,users:r.USERS.FIRSTGM}),r.register("updateDocuments",function(){var t=config_asyncToGenerator(config_regeneratorRuntime().mark((function _callee3(t){var r,o,a,i,l,c;return config_regeneratorRuntime().wrap((function _callee3$(u){for(;;)switch(u.prev=u.next){case 0:return r=t.uuid,o=t.documentType,a=t.data,i=t.options,u.next=3,fromUuid(r);case 3:if(l=u.sent){u.next=6;break}return u.abrupt("return",!1);case 6:return u.next=8,l.updateEmbeddedDocuments(o,a,i);case 8:return c=u.sent,u.abrupt("return",c.map((function(t){return t.uuid})));case 10:case"end":return u.stop()}}),_callee3)})));return function(r){return t.apply(this,arguments)}}(),{response:!0,timeout:5e3,users:r.USERS.FIRSTGM}),r.register("createActor",function(){var t=config_asyncToGenerator(config_regeneratorRuntime().mark((function _callee4(t){var r,o;return config_regeneratorRuntime().wrap((function _callee4$(a){for(;;)switch(a.prev=a.next){case 0:return r=t.data,a.next=3,Actor.implementation.create(r);case 3:return o=a.sent,a.abrupt("return",o.uuid);case 5:case"end":return a.stop()}}),_callee4)})));return function(r){return t.apply(this,arguments)}}(),{response:!0,timeout:5e3,users:r.USERS.FIRSTGM}),r.register("createEmbeddedDocuments",function(){var t=config_asyncToGenerator(config_regeneratorRuntime().mark((function _callee5(t){var r,o,a,i,l;return config_regeneratorRuntime().wrap((function _callee5$(c){for(;;)switch(c.prev=c.next){case 0:return r=t.parent,o=t.documentType,a=t.data,c.next=3,fromUuid(r);case 3:if(i=c.sent){c.next=6;break}return c.abrupt("return",!1);case 6:return c.next=8,i.createEmbeddedDocuments(o,a);case 8:return l=c.sent,c.abrupt("return",l.map((function(t){return t.uuid})));case 10:case"end":return c.stop()}}),_callee5)})));return function(r){return t.apply(this,arguments)}}(),{response:!0,timeout:5e3,users:r.USERS.FIRSTGM})}(),registerSettings()})),Hooks.on("getActorSheetHeaderButtons",(function(t,r){var o,a,i=null!==(o=t.document)&&void 0!==o?o:t.actor;(null===(a=i.token)||void 0===a||null===(a=a.flags[Z])||void 0===a?void 0:a.revertData)&&r.unshift({label:"Revert Transformation",class:"revert",icon:"fas fa-undo",onclick:function onclick(){Q.revertTransformation(i.token)}})})),Hooks.on("getHeaderControlsActorSheetV2",(function(t,r){var o,a,i=null!==(o=t.document)&&void 0!==o?o:t.actor;(null===(a=i.token)||void 0===a||null===(a=a.flags[Z])||void 0===a?void 0:a.revertData)&&r.unshift({label:"Revert Transformation",action:"revert",icon:"fas fa-undo",onClick:function onClick(){Q.revertTransformation(i.token)}})}))})();
//# sourceMappingURL=index.js.map